<!doctype html>
<html lang="ja">
<head prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<title>シェルスクリプト - Heavy Watal</title>
<link rel="stylesheet" href="/css/theme.css">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#e08010">
<meta name="theme-color" content="#e08010">
<meta name="author" content="Watal M. Iwasaki">
<meta property="og:title" content="シェルスクリプト">
<meta property="og:type" content="article">
<meta property="og:url" content="https://heavywatal.github.io/dev/sh.html">
<meta property="og:image" content="https://avatars.githubusercontent.com/heavywatal">
<meta property="og:description" content="">
<meta property="og:site_name" content="Heavy Watal">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@heavywatal">
<meta name="twitter:creator" content="@heavywatal">
<meta name="generator" content="Hugo 0.32-DEV" />
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  showProcessingMessages: false,
  messageStyle: "none",
  displayAlign: "left",
  displayIndent: "2em",
  tex2jax: {
    inlineMath: [['$','$']],
    displayMath: [['\\[', '\\]']]
  }
});
</script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML"></script>
<script type="application/ld+json">{
"@context": "http://schema.org",
"@type": "BreadcrumbList",
"itemListElement": [
 {"@type": "ListItem",
  "position": 1,
  "item": {
   "@id": "https://heavywatal.github.io/dev.html",
   "name": "dev"}},
 {"@type": "ListItem",
  "position": 2,
  "item": {
   "@id": "https://heavywatal.github.io/dev/sh.html",
   "name": "シェルスクリプト"}}
]}</script>

<script src="https://use.fontawesome.com/releases/v5.0.2/js/brands.js"></script>
<script src="https://use.fontawesome.com/releases/v5.0.2/js/solid.js"></script>
<script src="https://use.fontawesome.com/releases/v5.0.2/js/fontawesome.js"></script>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-41178626-2', 'auto');
ga('send', 'pageview');
</script>

</head>
<body>
<header><h1><a href="/">
<img class="logo" src="/heavywatal.svg" alt="岩嵜航">
Heavy Watal
</a></h1>
<form class="cse-search-box" action="/search.html">
<label><i class="fas fa-fw fa-search"></i><input type="text" name="q" aria-label="cse-search-box"></label>
</form>
</header>

<main>
<article>
<header><h1><a href="/dev/sh.html">
シェルスクリプト
</a></h1>
<nav class="tags"><ul>
<li><i class="fas fa-tag"></i> <a href="/tags/shell.html">shell</a></li>
</ul></nav>
</header>



<p><a href="https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html">https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html</a></p>

<h2 id="parameter-expansion">Parameter Expansion</h2>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nv">string</span><span class="o">=</span>0123456789abcdef
<span class="nv">array</span><span class="o">=(</span><span class="m">0</span> <span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">5</span> <span class="m">6</span> <span class="m">7</span> <span class="m">8</span> <span class="m">9</span> a b c d e f<span class="o">)</span>
<span class="nb">echo</span> <span class="si">${</span><span class="nv">string</span><span class="p">[1]</span><span class="si">}</span>  <span class="c1"># 0
</span><span class="c1"></span><span class="nb">echo</span> <span class="si">${</span><span class="nv">array</span><span class="p">[1]</span><span class="si">}</span>   <span class="c1"># 0
</span><span class="c1"></span><span class="nb">echo</span> <span class="si">${</span><span class="nv">string</span><span class="p">[-1]</span><span class="si">}</span> <span class="c1"># f
</span><span class="c1"></span><span class="nb">echo</span> <span class="si">${</span><span class="nv">array</span><span class="p">[-1]</span><span class="si">}</span>  <span class="c1"># f
</span><span class="c1"></span><span class="nb">echo</span> <span class="si">${#</span><span class="nv">string</span><span class="si">}</span>    <span class="c1"># 16
</span><span class="c1"></span><span class="nb">echo</span> <span class="si">${#</span><span class="nv">array</span><span class="si">}</span>     # <span class="m">16</span></code></pre></div>
<h3 id="special-parameters">Special Parameters</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nv">$0</span>        <span class="c1"># The full path of the script
</span><span class="c1"></span><span class="nv">$1</span>        <span class="c1"># First argument
</span><span class="c1"></span><span class="nv">$#</span>        <span class="c1"># The number of arguments ($0 is not included)
</span><span class="c1"></span><span class="nv">$*</span>        <span class="c1"># 全ての引数。&#34;$*&#34; はひと括り: &#34;$1 $2 $3&#34;
</span><span class="c1"></span><span class="nv">$@</span>        <span class="c1"># 全ての引数。&#34;$@&#34; は個別括り: &#34;$1&#34; &#34;$2&#34; &#34;$3&#34;
</span><span class="c1"></span><span class="nv">$@</span><span class="o">[</span><span class="m">2</span>,-1<span class="o">]</span>  <span class="c1"># 2つ目以降の引数(zshのみ？)
</span><span class="c1"></span><span class="nv">$-</span>        <span class="c1"># シェルの起動時のフラグ、setコマンドを使って設定したフラグの一覧
</span><span class="c1"></span><span class="nv">$$</span>        <span class="c1"># シェル自身のプロセスID
</span><span class="c1"></span><span class="nv">$!</span>        <span class="c1"># シェルが最後に起動したバックグラウンドプロセスのプロセスID
</span><span class="c1"></span><span class="nv">$?</span>        # 最後に実行したコマンドのexit値</code></pre></div>
<h3 id="character-string">Character String</h3>

<p>文字列の置換には正規表現を使える <code>sed</code> が便利。
でもパスや拡張子のちょっとした操作なら、
わざわざ外部コマンドやパイプを使わずにシェル(<code>bash</code>)の機能だけで実現できる。</p>

<ul>
<li><code>*</code> グロブの最短マッチか最長マッチが使える。（正規表現は使えない）</li>
<li><code>$@</code> や <code>$*</code> に対しては、個々の要素に対して実行されてリストが返される。</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="si">${</span><span class="nv">STR</span><span class="p">#pattern</span><span class="si">}</span>        <span class="c1"># sed -e &#34;s/^pattern//&#34;)     shortest
</span><span class="c1"></span><span class="si">${</span><span class="nv">STR</span><span class="p">##pattern</span><span class="si">}</span>       <span class="c1"># sed -e &#34;s/^pattern//&#34;)     longest
</span><span class="c1"></span><span class="si">${</span><span class="nv">STR</span><span class="p">%pattern</span><span class="si">}</span>        <span class="c1"># sed -e &#34;s/pattern$//&#34;)     shortest
</span><span class="c1"></span><span class="si">${</span><span class="nv">STR</span><span class="p">%%pattern</span><span class="si">}</span>       <span class="c1"># sed -e &#34;s/pattern$//&#34;)     longest
</span><span class="c1"></span><span class="si">${</span><span class="nv">STR</span><span class="p">/pattern/repl</span><span class="si">}</span>   <span class="c1"># sed -e &#34;s/pattern/repl/&#34;)
</span><span class="c1"></span><span class="si">${</span><span class="nv">STR</span><span class="p">//pattern/repl</span><span class="si">}</span>  <span class="c1"># sed -e &#34;s/pattern/repl/g&#34;)
</span><span class="c1"></span><span class="si">${</span><span class="nv">STR</span><span class="p">/#pattern/repl</span><span class="si">}</span>  <span class="c1"># sed -e &#34;s/^pattern/repl/&#34;)
</span><span class="c1"></span><span class="si">${</span><span class="nv">STR</span><span class="p">/%pattern/repl</span><span class="si">}</span>  <span class="c1"># sed -e &#34;s/pattern$/repl/&#34;)
</span><span class="c1"></span>
<span class="nv">BASENAME</span><span class="o">=</span><span class="si">${</span><span class="nv">PATH</span><span class="p">##*/</span><span class="si">}</span>
<span class="nv">DIRNAME</span><span class="o">=</span><span class="si">${</span><span class="nv">PATH</span><span class="p">%/*</span><span class="si">}</span>
<span class="nv">EXTENTION</span><span class="o">=</span><span class="si">${</span><span class="nv">PATH</span><span class="p">##*.</span><span class="si">}</span>
<span class="nv">BASENAME</span><span class="o">=</span><span class="si">${</span><span class="nv">FILENAME</span><span class="p">%.jpg</span><span class="si">}</span></code></pre></div>
<h3 id="other">Other</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1">## expression  # if VAR is null
</span><span class="c1"></span><span class="si">${</span><span class="nv">VAR</span><span class="k">:-</span><span class="nv">WORD</span><span class="si">}</span>  <span class="c1"># return WORD; VAR remains null
</span><span class="c1"></span><span class="si">${</span><span class="nv">VAR</span><span class="p">:=WORD</span><span class="si">}</span>  <span class="c1"># return WORD; VAR is assigned WORD
</span><span class="c1"></span><span class="si">${</span><span class="nv">VAR</span><span class="p">:?WORD</span><span class="si">}</span>  <span class="c1"># display error and exit
</span><span class="c1"></span><span class="si">${</span><span class="nv">VAR</span><span class="p">:+WORD</span><span class="si">}</span>  # nothing occurs<span class="p">;</span> otherwise <span class="k">return</span> WORD</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="si">${</span><span class="p">!PREFIX*</span><span class="si">}</span>  <span class="c1"># the names of variables begins with PREFIX
</span><span class="c1"></span><span class="si">${</span><span class="p">!PREFIX@</span><span class="si">}</span></code></pre></div>
<h2 id="misc">Misc</h2>

<h3 id="command">Command</h3>

<p>コマンドの結果を文字列として受け取る方法は
<code>`command</code>` と <code>$(command)</code> の2つあるが、
後者のほうが入れ子など柔軟に使える。</p>

<h3 id="arithmetic">Arithmetic</h3>

<p>足し算くらいなら <code>$((expression))</code> で</p>

<h3 id="コア数の取得">コア数の取得</h3>

<p>Linuxなら <code>/proc/cpuinfo</code>、
Macなら <code>system_profiler</code> 。でもたぶんIntelとPPCは書き方が違う。</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[[</span> -r /proc/cpuinfo <span class="o">]]</span> <span class="se">\
</span><span class="se"></span><span class="o">&amp;&amp;</span> <span class="nv">CORES</span><span class="o">=</span><span class="k">$(</span>grep cpuid /proc/cpuinfo <span class="p">|</span> wc -l<span class="k">)</span>
<span class="o">||</span> <span class="nv">CORES</span><span class="o">=</span>system_profiler <span class="p">|</span> grep Cores <span class="p">|</span> awk <span class="s1">&#39;{print $5}&#39;</span></code></pre></div>
<h2 id="関連書籍">関連書籍</h2>

<p><a href="https://www.amazon.co.jp/%E6%96%B0%E3%81%97%E3%81%84Linux%E3%81%AE%E6%95%99%E7%A7%91%E6%9B%B8-%E5%A4%A7%E8%A7%92-%E7%A5%90%E4%BB%8B/dp/4797380942/ref=as_li_ss_il?ie=UTF8&qid=1487931139&sr=8-2&keywords=linux&linkCode=li3&tag=heavywatal-22&linkId=2c6b6bd4a39dec96e1c6caed3bc52116" target="_blank"><img border="0" src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=4797380942&Format=_SL250_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=heavywatal-22" ></a><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=heavywatal-22&l=li3&o=9&a=4797380942" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></p>

</article>
</main>

<nav class="menu">

<div><a href="/about.html">About</a></div>

<div><a href="/research.html">Research Interests</a></div>

<input type="checkbox" id="menu-rstats">
<label for="menu-rstats">R stats</label>
<ul>
<li><a href="/rstats/intro.html">R自学自習の基礎知識</a></li>
<li><a href="/rstats/programming.html">RプログラミングTips</a></li>
<li><a href="/rstats/config.html">R環境設定</a></li>
<li><a href="/rstats/ggplot2.html">ggplot2</a></li>
<li><a href="/rstats/dplyr.html">dplyr</a></li>
<li><a href="/rstats/purrr.html">purrr</a></li>
<li><a href="/rstats/tidyr.html">tidyr</a></li>
<li><a href="/rstats/readr.html">readr</a></li>
<li><a href="/rstats/stringr.html">stringr</a></li>
<li><a href="/rstats/foreach.html">foreach/parallel</a></li>
<li><a href="/rstats/devtools.html">devtools</a></li>
<li><a href="/rstats/bioconductor.html">Bioconductor</a></li>
<li><a href="/rstats/rtracklayer.html">rtracklayer</a></li>
<li><a href="/rstats/biomart.html">biomaRt</a></li>
<li><a href="/rstats/ggbio.html">ggbio</a></li>
<li><a href="/rstats/edger.html">edgeR</a></li>
<li><a href="/rstats/topgo.html">topGO</a></li>
<li><a href="/rstats/stan.html">Stan</a></li>
<li><a href="/rstats/rgl.html">rgl</a></li>
<li><a href="/rstats/plyr.html">plyr</a></li>
<li><a href="/rstats/reshape2.html">reshape2</a></li>
</ul>

<input type="checkbox" id="menu-python">
<label for="menu-python">Python</label>
<ul>
<li><a href="/python/install.html">Pythonインストール</a></li>
<li><a href="/python/pip.html">pip</a></li>
<li><a href="/python/ipython.html">IPython</a></li>
<li><a href="/python/biopython.html">BioPython</a></li>
<li><a href="/python/scipy.html">NumPy, SciPy</a></li>
<li><a href="/python/pandas.html">Pandas</a></li>
<li><a href="/python/pyqt.html">PyQt</a></li>
<li><a href="/python/concurrent.html">concurrent.futures</a></li>
<li><a href="/python/copy.html">copy</a></li>
<li><a href="/python/matplotlib.html">matplotlib &#43; seaborn</a></li>
<li><a href="/python/setuptools.html">setuptools</a></li>
</ul>

<input type="checkbox" id="menu-cxx">
<label for="menu-cxx">C&#43;&#43;</label>
<ul>
<li><a href="/cxx/boost.html">Boost</a></li>
<li><a href="/cxx/getopt.html">C&#43;&#43;コマンドライン引数</a></li>
<li><a href="/cxx/speed.html">C&#43;&#43;高速化</a></li>
<li><a href="/cxx/clang.html">clang / llvm</a></li>
<li><a href="/cxx/gcc.html">gcc</a></li>
<li><a href="/cxx/bitwise.html">ビット演算</a></li>
<li><a href="/cxx/random.html">擬似乱数生成器</a></li>
</ul>

<input type="checkbox" id="menu-bio">
<label for="menu-bio">Biology</label>
<ul>
<li><a href="/bio/blast.html">BLAST</a></li>
<li><a href="/bio/gene_ontology.html">Gene Ontology</a></li>
<li><a href="/bio/meme.html">MEME</a></li>
<li><a href="/bio/popgen.html">Population Genetics</a></li>
<li><a href="/bio/repeatmasker.html">RepeatMasker</a></li>
<li><a href="/bio/samtools.html">SAMtools</a></li>
<li><a href="/bio/stochastic_process.html">Stochastic Process</a></li>
<li><a href="/bio/dadi.html">dadi</a></li>
<li><a href="/bio/mathmorph.html">数理形態学</a></li>
<li><a href="/bio/linear_algebra.html">線形代数</a></li>
<li><a href="/bio/complexnetwork.html">複雑ネットワーク</a></li>
<li><a href="/bio/nig.html">遺伝研スパコン</a></li>
<li><a href="/bio/motif.html">配列モチーフ探索</a></li>
</ul>

<input type="checkbox" id="menu-dev" checked>
<label for="menu-dev" class="active">Developer Tools</label>
<ul>
<li><a href="/dev/atom.html">Atom</a></li>
<li><a href="/dev/emacs.html">Emacs</a></li>
<li><a href="/dev/git.html">Git</a></li>
<li><a href="/dev/hugo.html">Hugo</a></li>
<li><a href="/dev/mercurial.html">Mercurial</a></li>
<li><a href="/dev/qt.html">Qt</a></li>
<li><a href="/dev/torque.html">TORQUE</a></li>
<li><a href="/dev/tex.html">TeX</a></li>
<li><a href="/dev/autotools.html">autoconf, automake</a></li>
<li><a href="/dev/make.html">make</a></li>
<li><a href="/dev/mount.html">mount</a></li>
<li><a href="/dev/nano.html">nano</a></li>
<li><a href="/dev/rsync.html">rsync</a></li>
<li><a href="/dev/ssh.html">ssh</a></li>
<li><a href="/dev/sshfs.html">sshfs</a></li>
<li><a href="/dev/tmux.html">tmux</a></li>
<li><a href="/dev/vi.html">vi</a></li>
<li><a href="/dev/zsh.html">zsh</a></li>
<li class="active"><a href="/dev/sh.html">シェルスクリプト</a></li>
<li><a href="/dev/nohup.html">プロセス管理</a></li>
<li><a href="/dev/devenv.html">開発環境</a></li>
</ul>

<input type="checkbox" id="menu-mac">
<label for="menu-mac">Mac</label>
<ul>
<li><a href="/mac/applescript.html">AppleScript</a></li>
<li><a href="/mac/homebrew.html">Homebrew</a></li>
<li><a href="/mac/keyboard.html">Keyboard</a></li>
<li><a href="/mac/macports.html">MacPorts</a></li>
<li><a href="/mac/command.html">Mac固有コマンド</a></li>
<li><a href="/mac/quicklook.html">QuickLook</a></li>
<li><a href="/mac/spotlight.html">Spotlight</a></li>
<li><a href="/mac/winebottler.html">WineBottler</a></li>
<li><a href="/mac/kotoeri.html">ことえり</a></li>
</ul>

<input type="checkbox" id="menu-lectures">
<label for="menu-lectures">Lectures</label>
<ul>
<li><a href="/lectures/verhoef_comm_ecol-11.html">Community Ecology 輪読会 11章</a></li>
<li><a href="/lectures/prml-11-1.html">PRML輪読会 11章1節</a></li>
<li><a href="/lectures/prml-2-1.html">PRML輪読会 2章前半</a></li>
<li><a href="/lectures/prml-3-4.html">PRML輪読会 3章4節</a></li>
<li><a href="/lectures/wakeley-2-2.html">Wakeley輪読会 2章2節</a></li>
</ul>

<input type="checkbox" id="menu-misc">
<label for="menu-misc">Miscellaneous</label>
<ul>
<li><a href="/misc/fonts.html">Fonts</a></li>
<li><a href="/misc/mailman.html">Mailman</a></li>
<li><a href="/misc/vnc.html">VNCによる画面共有</a></li>
<li><a href="/misc/virtualbox.html">VirtualBox</a></li>
</ul>

<div><a href="/tags.html">Tags</a></div>
</nav>

<footer><small>(ɔ) 2008 岩嵜航 Watal M. Iwasaki</small></footer>
</body>
</html>


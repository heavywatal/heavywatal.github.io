<!doctype html>
<html lang="ja">
<head prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<title>ggplot2: きれいなグラフを簡単に合理的に - Heavy Watal</title>
<link rel="stylesheet" href="/css/theme.css">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#e08010">
<meta name="theme-color" content="#e08010">
<meta name="author" content="Watal M. Iwasaki">
<meta property="og:title" content="ggplot2: きれいなグラフを簡単に合理的に">
<meta property="og:type" content="article">
<meta property="og:url" content="https://heavywatal.github.io/rstats/ggplot2.html">
<meta property="og:image" content="https://avatars.githubusercontent.com/heavywatal">
<meta property="og:description" content="">
<meta property="og:site_name" content="Heavy Watal">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@heavywatal">
<meta name="twitter:creator" content="@heavywatal">
<meta name="generator" content="Hugo 0.41-DEV" />
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  showProcessingMessages: false,
  messageStyle: "none",
  displayAlign: "left",
  displayIndent: "2em",
  tex2jax: {
    inlineMath: [['$','$']],
    displayMath: [['\\[', '\\]']]
  }
});
</script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML"></script>
<script type="application/ld+json">{
"@context": "http://schema.org",
"@type": "BreadcrumbList",
"itemListElement": [
 {"@type": "ListItem",
  "position": 1,
  "item": {
   "@id": "https://heavywatal.github.io/rstats.html",
   "name": "rstats"}},
 {"@type": "ListItem",
  "position": 2,
  "item": {
   "@id": "https://heavywatal.github.io/rstats/ggplot2.html",
   "name": "ggplot2"}}
]}</script>

<script src="https://use.fontawesome.com/releases/v5.0.10/js/brands.js"></script>
<script src="https://use.fontawesome.com/releases/v5.0.10/js/solid.js"></script>
<script src="https://use.fontawesome.com/releases/v5.0.10/js/fontawesome.js"></script>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-41178626-2', 'auto');
ga('send', 'pageview');
</script>

</head>
<body>
<header><h1><a href="/">
<img class="logo" src="/heavywatal.svg" alt="岩嵜航">
Heavy Watal
</a></h1>
<form class="cse-search-box" action="/search.html">
<label><i class="fas fa-fw fa-search"></i><input type="text" name="q" aria-label="cse-search-box"></label>
</form>
</header>

<main>
<article>
<header><h1><a href="/rstats/ggplot2.html">
ggplot2 — きれいなグラフを簡単に合理的に
</a></h1>
<nav class="tags"><ul>
<li><i class="fas fa-tag"></i> <a href="/tags/r.html">r</a></li>
<li><i class="fas fa-tag"></i> <a href="/tags/graph.html">graph</a></li>
<li><i class="fas fa-tag"></i> <a href="/tags/tidyverse.html">tidyverse</a></li>
</ul></nav>
</header>



<p><a href="https://ggplot2.tidyverse.org/">
<img src="https://ggplot2.tidyverse.org/logo.png" align="right" width="120" height="139">
</a></p>

<p>Rのグラフ描画システムには<code>graphics</code>と<code>grid</code>の2つが存在しており、
R標準の<code>plot()</code>などは前者の上に、
本項で扱う<code>ggplot2</code>は後者の上に成り立っている。
使い方が全く異なるので、前者のことを知る必要はない。</p>

<p><a href="https://tidyverse.tidyverse.org/">tidyverse</a> に含まれているので、
<code>install.packages('tidyverse')</code> で一括インストール、
<code>library(tidyverse)</code> で一括ロード。</p>

<ul>
<li><a href="https://ggplot2.tidyverse.org">https://ggplot2.tidyverse.org</a></li>
<li><a href="http://r4ds.had.co.nz/data-visualisation.html">http://r4ds.had.co.nz/data-visualisation.html</a></li>
<li><a href="http://r4ds.had.co.nz/graphics-for-communication.html">http://r4ds.had.co.nz/graphics-for-communication.html</a></li>
<li><a href="http://www.cookbook-r.com/Graphs/">http://www.cookbook-r.com/Graphs/</a></li>
<li><a href="https://blog.rstudio.org/2015/12/21/ggplot2-2-0-0/">version 2.0での変更点</a></li>
</ul>

<h2 id="基本的な使い方">基本的な使い方</h2>

<p>R に入ってるお馴染みサンプルデータ <code>iris</code> を使って</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="c1">## ライブラリの読み込み</span>
<span class="kn">library</span><span class="p">(</span>tidyverse<span class="p">)</span>

<span class="c1">## データと全体設定を持ったggplotオブジェクトを作る</span>
gp <span class="o">=</span> ggplot<span class="p">(</span>iris<span class="p">,</span> aes<span class="p">(</span>x<span class="o">=</span>Sepal.Width<span class="p">,</span> y<span class="o">=</span>Sepal.Length<span class="p">,</span> colour<span class="o">=</span>Species<span class="p">))</span>

<span class="c1">## 散布図のレイヤーを重ねる</span>
gp <span class="o">=</span> gp <span class="o">+</span> geom_point<span class="p">(</span>size<span class="o">=</span><span class="m">3</span><span class="p">,</span> alpha<span class="o">=</span><span class="m">0.7</span><span class="p">)</span>

<span class="c1">## 描画してみる</span>
<span class="kp">print</span><span class="p">(</span>gp<span class="p">)</span>

<span class="c1">## 回帰曲線を重ねたり、タイトルやテーマの設定をしたり</span>
gp <span class="o">=</span> gp <span class="o">+</span> stat_smooth<span class="p">(</span>method<span class="o">=</span>glm<span class="p">,</span> method.args<span class="o">=</span><span class="kt">list</span><span class="p">(</span>family<span class="o">=</span>gaussian<span class="p">))</span>
gp <span class="o">=</span> gp <span class="o">+</span> labs<span class="p">(</span>title<span class="o">=</span><span class="s">&#34;Iris Sepal&#34;</span><span class="p">)</span>
gp <span class="o">=</span> gp <span class="o">+</span> theme_bw<span class="p">()</span>
gp <span class="o">=</span> gp <span class="o">+</span> theme<span class="p">(</span>panel.grid.minor<span class="o">=</span>element_blank<span class="p">())</span>
<span class="kp">print</span><span class="p">(</span>gp<span class="p">)</span>

<span class="c1">## ファイルに保存</span>
ggsave<span class="p">(</span><span class="s">&#34;iris_sepal.png&#34;</span><span class="p">,</span> gp<span class="p">,</span> width <span class="o">=</span> <span class="m">4</span><span class="p">,</span> height <span class="o">=</span> <span class="m">4</span><span class="p">)</span></code></pre></div>
<p><code>ggplot()</code> に渡すデータは、1行が1観測、1列が1変数という形の
<a href="/rstats/programming.html#tidyverse"><strong>整然データ</strong></a></p>

<h2 id="プロットの種類">プロットの種類</h2>

<dl>
<dt><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">散布図</a></dt>
<dd><code>gp + geom_point(size=2, alpha=0.3)</code></dd>
<dd>重なった点をランダムにばらかしたいときは
<a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html"><code>geom_jitter()</code></a></dd>
<dd><a href="https://ggplot2.tidyverse.org/articles/ggplot2-specs.html#sec:shape-spec">点の形(shape)一覧</a></dd>
<dt><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">折れ線グラフ</a></dt>
<dd><code>gp + geom_path(size=2, linetype=&quot;dashed&quot;)</code> データ順に結ぶ</dd>
<dd><code>gp + geom_line()</code> x軸上の順で結ぶ</dd>
<dd><code>gp + geom_step()</code> 階段状に結ぶ</dd>
<dd><a href="https://ggplot2.tidyverse.org/articles/ggplot2-specs.html#sec:line-type-spec">線の種類(linetype)一覧</a></dd>
<dt><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">面グラフ</a></dt>
<dd><code>gp + geom_ribbon()</code> &mdash; yminからymaxの面</dd>
<dd><code>gp + geom_area()</code> &mdash; 0からyの面</dd>
<dt><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">ヒストグラム、密度曲線</a></dt>
<dd><code>gp + geom_histogram()</code> &mdash; 棒グラフ(連続値を<code>stat_bin()</code> で区切って)</dd>
<dd><code>gp + geom_bar()</code> &mdash; 棒グラフ(離散値を<code>stat_count()</code>で数えて)</dd>
<dd><code>gp + geom_freqpoly()</code> &mdash; 折れ線</dd>
<dd><code>gp + geom_density()</code> &mdash; 密度推定されたスムーズな線</dd>
<dd><code>gp + geom_bin2d()</code> &mdash; 二次元ヒストグラム</dd>
<dd><code>gp + geom_hex()</code> &mdash; 六角形版二次元ヒストグラム</dd>
<dt><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">棒グラフ</a></dt>
<dd><code>gp + geom_col()</code></dd>
<dd>グループ分けする場合のオプション:

<ul>
<li><a href="https://ggplot2.tidyverse.org/reference/position_stack.html"><code>position='stack'</code></a>:
縦に積み重ねる (デフォルト)</li>
<li><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html"><code>position='dodge'</code></a>:
横に並べる</li>
<li><code>position='fill'</code>: 縦に積み重ね、高さを1に揃えて割合を示す</li>
</ul></dd>
<dt><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">箱ひげ図</a></dt>
<dd><code>gp + geom_boxplot()</code></dd>
<dd><code>gp + geom_violin()</code></dd>
<dt><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">ヒートマップ</a></dt>
<dd><code>gp + geom_tile(aes(fill=z))</code></dd>
<dd><code>gp + geom_raster(aes(fill=z))</code> &mdash; 各タイルの大きさを揃える制約のため高速</dd>
<dt><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">エラーバー</a></dt>
<dd><code>gp + geom_errorbar(aes(ymax = y + se, ymin = y - se), width = 0.1)</code></dd>
<dd><code>gp + geom_linerange(...)</code></dd>
<dd><code>gp + geom_pointrange(...)</code></dd>
<dt><a href="https://ggplot2.tidyverse.org/reference/stat_function.html">関数</a></dt>
<dd><code>ggplot(data.frame(x=c(-4, 4)), aes(x)) + stat_function(fun=dnorm, args=c(0, 1), n=200)</code></dd>
</dl>

<hr>

<dl>
<dt><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">回帰曲線</a></dt>
<dd><code>gp + geom_smooth(method=glm, method.args=list(family=poisson), se=FALSE)</code></dd>
<dt><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">切片と傾きで直線を描く</a></dt>
<dd><code>gp + geom_abline(intercept=3, slope=5)</code></dd>
<dd><code>gp + geom_hline(yintercept=7) + geom_vline(xintercept=11)</code></dd>
<dt><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">始点と終点で曲線や矢印を描く</a></dt>
<dd><code>gp + geom_curve(aes(x, y, xend, yend), curvature = -0.2)</code></dd>
<dd><code>gp + geom_segment(aes(x, y, xend, yend), arrow=arrow())</code></dd>
<dd>矢印の調整は <a href="https://www.rdocumentation.org/packages/grid/topics/arrow"><code>grid::arrow()</code></a></dd>
<dt><a href="https://ggplot2.tidyverse.org/reference/annotate.html">文字列や図形を書き加える</a></dt>
<dd><code>gp + annotate(&quot;text&quot;, x=1:4, y=4:1, label=sprintf(&quot;x = %d&quot;, 1:4))</code></dd>
<dd>テーマの <code>base_family</code> は引き継がれないので <code>family=</code> で指定すべし。</dd>
<dd>数式を表示するには <code>label=&quot;italic(N[t])&quot;</code> のような文字列で渡して <code>parse=TRUE</code>。</dd>
<dd>データ点に対応する文字列を添えるには
<code>gp + geom_text(aes(label=foo))</code> のほうが適している。
オプションで <code>nudge_x=2, nudge_y=2</code> などとすれば点と重ならないようにずらせる。
<a href="https://ggplot2.tidyverse.org/reference/position_nudge.html"><code>position_nudge()</code></a></dd>
</dl>

<h2 id="変数によってグループ分け-https-ggplot2-tidyverse-org-reference-aes-group-order-html"><a href="https://ggplot2.tidyverse.org/reference/aes_group_order.html">変数によってグループ分け</a></h2>

<p><code>aes(colour = Species)</code> のように <code>aes()</code> 内で列名を指定すると、
その変数に応じて色やサイズなどを変えることができる。
言い換えると、データの値を色やサイズに変換する(スケールする)ことに相当する。
<code>aes()</code> の外で指定するとデータによらず全体に反映される:</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="c1"># サイズは常に3、色は species という列のデータによって変える</span>
gp <span class="o">+</span> geom_point<span class="p">(</span>aes<span class="p">(</span>colour <span class="o">=</span> species<span class="p">),</span> size <span class="o">=</span> <span class="m">3</span><span class="p">)</span>

<span class="c1"># 色は常に赤、サイズは frequency という列の値に比例</span>
gp <span class="o">+</span> geom_point<span class="p">(</span>aes<span class="p">(</span>size <span class="o">=</span> frequency<span class="p">),</span> colour <span class="o">=</span> <span class="s">&#34;red&#34;</span><span class="p">)</span></code></pre></div>
<ul>
<li><a href="https://ggplot2.tidyverse.org/reference/aes_colour_fill_alpha.html">色・透明度を変える</a>

<ul>
<li><code>colour</code>: 点や線の色</li>
<li><code>fill</code>: 塗りつぶしの色</li>
<li><a href="https://ggplot2.tidyverse.org/reference/scale_alpha.html"><code>alpha</code></a>: 不透明度 (0が透明、1が不透明)</li>
</ul></li>
<li><a href="https://ggplot2.tidyverse.org/reference/aes_linetype_size_shape.html">大きさ・形を変える</a>

<ul>
<li><a href="https://ggplot2.tidyverse.org/reference/scale_size.html"><code>size</code></a>: 点や線のサイズ</li>
<li><a href="https://ggplot2.tidyverse.org/reference/scale_shape.html"><code>shape</code></a>: 点の形</li>
<li><a href="https://ggplot2.tidyverse.org/reference/scale_linetype.html"><code>linetype</code></a>: 線</li>
</ul></li>
<li>単にグループ分けする

<ul>
<li><code>group</code>: 色や形はそのままにグループ分け。反復試行の折れ線グラフなどに。</li>
</ul></li>
</ul>

<h3 id="scale-関数で調整"><code>scale_*()</code> 関数で調整</h3>

<p>変数をどうやって色やサイズに反映させるか、
各項目に対応する <code>scale_*()</code> 関数で調整する。</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">gp <span class="o">+</span> geom_point<span class="p">(</span>aes<span class="p">(</span>colour <span class="o">=</span> species<span class="p">))</span> <span class="o">+</span>
  scale_colour_brewer<span class="p">(</span>palette <span class="o">=</span> <span class="s">&#34;Spectral&#34;</span><span class="p">)</span></code></pre></div>
<dl>
<dt><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html"><code>scale_*_brewer</code></a></dt>
<dd>for <code>colour</code>, <code>fill</code></dd>
<dd>いい感じに考えられたパレット <a href="http://colorbrewer2.org/">Colorbrewer</a>
から選んで指定するだけなので楽ちん。
利用可能なパレットは <code>RColorBrewer::display.brewer.all()</code> でも一覧できる。</dd>
<dd><code>scale_*_brewer(..., palette='Blues', direction=1)</code>: 離散値</dd>
<dd><code>scale_*_distiller(..., palette='Blues', direction=-1)</code>: 連続値</dd>
<dd>色覚多様性への対応をさらに強化するなら
<a href="https://github.com/sjmgarnier/viridis"><code>library(viridis)</code></a> の
<code>viridis::scale_*_viridis(..., direction=1, discrete=FALSE, options=&quot;viridis&quot;)</code>
を使うのがよさそう。</dd>
<dt><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html"><code>scale_*_gradient</code></a></dt>
<dd>for <code>colour</code>, <code>fill</code></dd>
<dd>グラデーションの基準となる色を指定する。</dd>
<dd><code>scale_*_gradient(..., low, high, ...)</code>: 普通の連続値に</dd>
<dd><code>scale_*_gradient2(..., low, mid, high, midpoint=0, ...)</code>: ある中央値を挟んで上下に分けたいとき</dd>
<dd><code>scale_*_gradientn(..., colours, values=NULL, ...)</code>: 多色のヒートマップなどに e.g., <code>colours=c('#000000', '#0000FF', '#00FFFF', '#00FF00', '#FFFF00', '#FF0000')</code></dd>
<dt><a href="https://ggplot2.tidyverse.org/reference/scale_identity.html"><code>scale_*_identity</code></a></dt>
<dd>for <code>colour</code>, <code>fill</code>, <code>size</code>, <code>shape</code>, <code>linetype</code>, <code>alpha</code></dd>
<dd>色の名前やサイズなどを示す列が予めデータに含まれている場合にそのまま使う。
<a href="https://ggplot2.tidyverse.org/articles/ggplot2-specs.html">点や線の種類</a></dd>
<dt><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html"><code>scale_*_manual</code></a></dt>
<dd>for <code>colour</code>, <code>fill</code>, <code>size</code>, <code>shape</code>, <code>linetype</code>, <code>alpha</code></dd>
<dd>対応関係を <code>values</code> 引数で直に指定する。</dd>
<dt><a href="https://ggplot2.tidyverse.org/reference/scale_size.html"><code>scale_size</code></a></dt>
<dd>デフォルトではpointの面積を値にほぼ比例させるが、面積0にはならない。
値0に面積0を対応させるには <code>scale_size_area()</code> を使う。
半径を比例させるには <code>scale_radius()</code> があるけど要注意。</dd>
</dl>

<p><a href="https://ggplot2.tidyverse.org/reference/scale_alpha.html"><code>scale_alpha(..., range=c(0.1, 1))</code></a><br>
<a href="https://ggplot2.tidyverse.org/reference/scale_linetype.html"><code>scale_linetype</code></a><br>
<a href="https://ggplot2.tidyverse.org/reference/scale_shape.html"><code>scale_shape</code></a></p>

<h3 id="スケール共通オプション">スケール共通オプション</h3>

<p>値と見え方の対応関係が凡例(legend/colourbar)として表示される。
<code>scale_*()</code> 関数に以下のオプションを指定することで設定を変えられる。
<a href="https://ggplot2.tidyverse.org/reference/continuous_scale.html">連続値の場合</a> と
<a href="https://ggplot2.tidyverse.org/reference/discrete_scale.html">離散値の場合</a>
で微妙に意味が変わるけどだいたいこんな感じ:</p>

<ul>
<li><code>name</code>: 凡例のタイトル。複数スケールで同じ名前にすると凡例が統合される。</li>
<li><code>breaks</code>: 目盛りや凡例に登場させる値。</li>
<li><code>labels</code>: breaksの値に対応する文字列。デフォルトはbreaksそのまま。</li>
<li><code>na.value</code>: 欠損値のときどうするか</li>
<li><code>limits</code>: 数値なら最大値と最小値のvector。
文字列なら表示したいすべての値(順序も反映される)。</li>
<li><code>guide</code>: 文字列で <code>&quot;legend&quot;</code> か <code>&quot;colourbar&quot;</code>。
さらに細かく制御したい場合は
<a href="https://ggplot2.tidyverse.org/reference/guide_legend.html"><code>guide_legend()</code></a> や
<a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html"><code>guide_colourbar()</code></a>
で。
消したい場合は <code>&quot;none&quot;</code> か <code>FALSE</code> を渡せる。</li>
</ul>

<h3 id="変数によってパネルを分割する">変数によってパネルを分割する</h3>

<p>年ごとや種ごとに傾向を見たいときなど、データに応じてパネルを分割して並べる。</p>

<dl>
<dt><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html"><code>facet_wrap()</code></a></dt>
<dd><p>1変数で分割して並べる</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">facet_wrap<span class="p">(</span>facets<span class="p">,</span> nrow<span class="o">=</span><span class="kc">NULL</span><span class="p">,</span> ncol<span class="o">=</span><span class="kc">NULL</span><span class="p">,</span> scales<span class="o">=</span><span class="s">&#39;fixed&#39;</span><span class="p">,</span>
           shrink<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> labeller<span class="o">=</span><span class="s">&#39;label_value&#39;</span><span class="p">,</span>
           as.table<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="kr">switch</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span> drop<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>
           dir<span class="o">=</span><span class="s">&#39;h&#39;</span><span class="p">,</span> strip.position<span class="o">=</span><span class="s">&#39;top&#39;</span><span class="p">)</span>

ggplot<span class="p">(</span>iris<span class="p">,</span> aes<span class="p">(</span>Petal.Length<span class="p">,</span> Sepal.Length<span class="p">))</span> <span class="o">+</span> geom_point<span class="p">()</span> <span class="o">+</span>
  facet_wrap<span class="p">(</span><span class="o">~</span>Species<span class="p">,</span> nrow<span class="o">=</span><span class="m">2</span><span class="p">)</span></code></pre></div></dd>
<dt><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html"><code>facet_grid()</code></a></dt>
<dd><p>2変数で分割して縦横に並べる</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">facet_grid<span class="p">(</span>facets<span class="p">,</span> margins<span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> scales<span class="o">=</span><span class="s">&#39;fixed&#39;</span><span class="p">,</span> space<span class="o">=</span><span class="s">&#39;fixed&#39;</span><span class="p">,</span>
           shrink<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> labeller<span class="o">=</span><span class="s">&#39;label_value&#39;</span><span class="p">,</span>
           as.table<span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="kr">switch</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span> drop<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>

ggplot<span class="p">(</span>iris<span class="p">,</span> aes<span class="p">(</span>Petal.Length<span class="p">,</span> Sepal.Length<span class="p">))</span> <span class="o">+</span> geom_point<span class="p">()</span> <span class="o">+</span>
  facet_grid<span class="p">(</span><span class="m">.</span> <span class="o">~</span> Species<span class="p">)</span></code></pre></div>
<p>1変数でいい場合は片方をドット <code>.</code> で固定できる。</p></dd>
<dt><a href="https://ggplot2.tidyverse.org/reference/labellers.html">ファセットラベルの調整</a></dt>
<dd><p>デフォルトでは値だけがfacetラベルに表示されるが、
変数名を同時に表示したり、数式を表示したりもできる。
見た目の調整はテーマの <code>strip.*</code> で。</p></dd>
</dl>

<h3 id="内部変数を使う">内部変数を使う</h3>

<p><a href="https://github.com/hadley/ggplot2-book/blob/master/layers.rmd#generated-variables">https://github.com/hadley/ggplot2-book/blob/master/layers.rmd#generated-variables</a></p>

<p>ヒストグラムや箱ヒゲなどの表示に必要な計算は
ggplot内部で <code>stat_*()</code> を通して行われる。
そうした値 (computed variables) の一部は
<code>..count..</code> や <code>..density..</code> みたいに
ピリオドで囲まれた特殊な名前で参照することができる。</p>

<h2 id="軸やタイトルを変更">軸やタイトルを変更</h2>

<dl>
<dt><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">軸の区切りを変更したり対数にしたり</a></dt>
<dd><code>gp + scale_x_continuous(breaks=seq(10, 100, by=10))</code></dd>
<dd><code>gp + scale_y_log10(&quot;Beer consumption&quot;)</code></dd>
<dd><code>gp + scale_y_reverse()</code></dd>
<dd>上記の<a href="#スケール共通オプション">スケール共通オプション</a>に加えて:

<ul>
<li><code>expand</code>: デフォルトでは値域よりも少し余裕を持たせてあるが
<code>c(0, 0)</code> を与えるとピッタリになる。<code>geom_tile()</code>を使うときなどに。</li>
<li><code>trans</code>: 数値の変換。exp, identity, log, log10, reciprocal, reverse など。
文字列変数の順序を変えたい場合は <code>limits</code> のほうを使う。</li>
<li><code>position</code>: top, bottom, left, right</li>
<li><code>sec.axis</code>: 第二軸</li>
</ul></dd>
<dt><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">描画する範囲を指定</a></dt>
<dd><code>gp + ylim(0, 42) + xlim(&quot;b&quot;, &quot;c&quot;, &quot;d&quot;)</code></dd>
<dd><code>gp + coord_cartesian(xlim = NULL, ylim = NULL)</code></dd>
<dd>前者はデータそのものを切るが、後者はデータを変えずに描画領域だけ切る</dd>
<dt><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">X軸とY軸の比率を固定</a></dt>
<dd><code>gp + coord_fixed(ratio=1)</code></dd>
<dt><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">XY軸の反転</a></dt>
<dd><code>gp + coord_flip()</code></dd>
<dt><a href="https://ggplot2.tidyverse.org/reference/coord_polar.html">極座標</a></dt>
<dd>パイチャートも作れるらしい</dd>
<dt><a href="https://ggplot2.tidyverse.org/reference/coord_trans.html">座標変換</a></dt>
<dd><code>gp + coord_trans(x='log10', y='sqrt')</code></dd>
<dd>表示する座標を変換する。
 stat前に適用される <code>scale_x_*</code> とは微妙に違う。</dd>
<dt><a href="https://ggplot2.tidyverse.org/reference/labs.html">軸ラベルとタイトル</a></dt>
<dd><code>gp + labs(x=&quot;time&quot;, y=&quot;weight&quot;, title=&quot;growth&quot;)</code></dd>
<dd><code>gp + xlab(&quot;time&quot;) + ylab(&quot;weight&quot;) + ggtitle(&quot;growth&quot;)</code></dd>
</dl>

<h2 id="theme-背景やラベルの調整"><code>theme</code>: 背景やラベルの調整</h2>

<p><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">https://ggplot2.tidyverse.org/reference/ggtheme.html</a></p>

<h3 id="既成テーマ">既成テーマ</h3>

<dl>
<dt><code>theme_grey(base_size=11, base_family='')</code>, <code>theme_gray(...)</code></dt>
<dd>灰色背景に白い格子。
ggplotらしいデフォルトだが、論文には使いにくい。</dd>
<dt><code>theme_bw(base_size=11, base_family='')</code></dt>
<dd>黒枠白背景にうっすら灰色格子</dd>
<dt><code>theme_linedraw(base_size=11, base_family='')</code></dt>
<dd>細いけど濃い色の <code>panel.grid</code></dd>
<dt><code>theme_light(base_size=11, base_family='')</code></dt>
<dd>それを薄くした感じ</dd>
<dt><code>theme_minimal(base_size=11, base_family='')</code></dt>
<dd>外枠なしの <code>theme_bw</code></dd>
<dt><code>theme_classic(base_size=11, base_family='')</code></dt>
<dd>xy軸がL字に描かれているだけで枠もグリッドも無し</dd>
<dt><code>theme_void(base_size=11, base_family='')</code></dt>
<dd>完全に枠なし</dd>
</dl>

<p>これらをカッコ無しでコンソールに打ち込むと、
下記の各エレメントの設定方法やデフォルト値を知ることができる。</p>

<p>引数として <code>base_family</code> に&rdquo;Helvetica Neue&rdquo;などのフォントを指定できる。
Macなら&rdquo;HiraKakuProN-W3&rdquo;を指定すれば日本語でも文字化けしなくなるはず。
テーマを構成する <code>axis.text</code> などはこの設定を継承するが、
<code>geom_text()</code> などプロット内部の要素には引き継がれないことに注意。</p>

<p>ほかにもいろんなテーマが
<a href="https://cran.r-project.org/web/packages/ggthemes/vignettes/ggthemes.html">ggthemes</a>
というパッケージで提供されている。</p>

<h3 id="設定項目">設定項目</h3>

<p><a href="https://ggplot2.tidyverse.org/reference/theme.html">https://ggplot2.tidyverse.org/reference/theme.html</a></p>

<p><code>theme()</code> 関数に項目と値を指定したものを、
ほかのレイヤーと同じようにどんどん足しながら変更していく。
テーマは直線、長方形、文字の3種類のエレメントからなり、
それらの性質を変更する場合は <code>element_***()</code> を介して行う</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="c1">## ベースとなるテーマを先に適用してから</span>
gp <span class="o">=</span> gp <span class="o">+</span> theme_bw<span class="p">(</span>base_family<span class="o">=</span><span class="s">&#39;HiraKakuProN-W3&#39;</span><span class="p">,</span> base_size<span class="o">=</span><span class="m">14</span><span class="p">)</span>
gp <span class="o">=</span> gp <span class="o">+</span> theme<span class="p">(</span>legend.position<span class="o">=</span><span class="s">&#39;bottom&#39;</span><span class="p">)</span>
gp <span class="o">=</span> gp <span class="o">+</span> theme<span class="p">(</span>plot.background<span class="o">=</span>element_rect<span class="p">(</span>fill<span class="o">=</span><span class="s">&#34;transparent&#34;</span><span class="p">))</span></code></pre></div>
<dl>
<dt>全体</dt>
<dd><code>line</code>: (<code>element_line</code>)</dd>
<dd><code>rect</code>: (<code>element_rect</code>)</dd>
<dd><code>text</code>: (<code>element_text</code>)</dd>
<dd><code>title</code>: (<code>element_text</code>; inherits from <code>text</code>)</dd>
<dd><code>aspect.ratio</code>:</dd>
<dt>軸タイトル、軸ラベル、目盛</dt>
<dd><code>axis.title</code>: (<code>element_text</code>; inherits from <code>text</code>)<br>
&emsp;<code>__.x</code>, <code>__.x.top</code>, <code>__.y</code>, <code>__.y.right</code></dd>
<dd><code>axis.text</code>: (<code>element_text</code>; inherits from <code>text</code>)<br>
&emsp;<code>__.x</code>, <code>__.x.top</code>, <code>__.y</code>, <code>__.y.right</code></dd>
<dd><code>axis.ticks</code>: (<code>element_line</code>; inherits from <code>line</code>)<br>
&emsp;<code>__.x</code>, <code>__.y</code></dd>
<dd><code>axis.ticks.length</code>: (<code>unit</code>)</dd>
<dd><code>axis.line</code>: (<code>element_line</code>; inherits from <code>line</code>)<br>
&emsp;<code>__.x</code>, <code>__.y</code></dd>
<dt>凡例</dt>
<dd><code>legend.background</code>: (<code>element_rect</code>; inherits from <code>rect</code>)</dd>
<dd><code>legend.margin</code>: (<code>margin</code>)</dd>
<dd><code>legend.spacing</code>:(<code>unit</code>)<br>
&emsp;<code>__.x</code>, <code>__.y</code></dd>
<dd><code>legend.key</code>: (<code>element_rect</code>; inherits from <code>rect</code>)</dd>
<dd><code>legend.key.size</code>: (<code>unit</code>)</dd>
<dd><code>legend.key.height</code>: (<code>unit</code>; inherits from <code>legend.key.size</code>)</dd>
<dd><code>legend.key.width</code>: (<code>unit</code>; inherits from <code>legend.key.size</code>)</dd>
<dd><code>legend.text</code>: (<code>element_text</code>; inherits from <code>text</code>)</dd>
<dd><code>legend.text.align</code>: (number from <code>0</code> (left) to <code>1</code> (right))</dd>
<dd><code>legend.title</code>: (<code>element_text</code>; inherits from <code>title</code>)</dd>
<dd><code>legend.title.align</code>: (number from <code>0</code> (left) to <code>1</code> (right))</dd>
<dd><code>legend.position</code>: (<code>&quot;left&quot;</code>, <code>&quot;right&quot;</code>, <code>&quot;bottom&quot;</code>, <code>&quot;top&quot;</code>, <code>&quot;none&quot;</code> <code>c(0, 1)</code>)</dd>
<dd><code>legend.direction</code>: (<code>&quot;horizontal&quot;</code> or <code>&quot;vertical&quot;</code>)</dd>
<dd><code>legend.justification</code>: (<code>&quot;center&quot;</code> or <code>c(0, 1)</code> のような数値でアンカー位置を指定)</dd>
<dd><code>legend.box</code>: (<code>&quot;horizontal&quot;</code> or <code>&quot;vertical&quot;</code>)</dd>
<dd><code>legend.box.just</code>: (<code>&quot;top&quot;</code>, <code>&quot;bottom&quot;</code>, <code>&quot;left&quot;</code>, or <code>&quot;right&quot;</code>)</dd>
<dd><code>legend.box.margin</code>: (<code>margin</code>)</dd>
<dd><code>legend.box.background: (</code>element_rect<code>; inherits from</code>rect`)</dd>
<dd><code>legend.box.spacing</code>:(<code>unit</code>)</dd>
<dt>プロット領域の背景、余白、格子</dt>
<dd><code>panel.background</code>: (<code>element_rect</code>; inherits from <code>rect</code>)</dd>
<dd><code>panel.border</code>: (<code>element_rect</code>; inherits from <code>rect</code>; should be used with <code>fill=NA</code>)</dd>
<dd><code>panel.spacing</code>: (<code>unit</code>; <code>facet_*</code> の間隔)<br>
&emsp;<code>__.x</code>, <code>__.y</code></dd>
<dd><code>panel.grid</code>: (<code>element_line</code>; inherits from <code>line</code>)</dd>
<dd><code>panel.grid.major</code>: (<code>element_line</code>; inherits from <code>panel.grid</code>)<br>
&emsp;<code>__.x</code>, <code>__.y</code></dd>
<dd><code>panel.grid.minor</code>: (<code>element_line</code>; inherits from <code>panel.grid</code>)<br>
&emsp;<code>__.x</code>, <code>__.y</code></dd>
<dt>全体の背景、タイトル、余白</dt>
<dd><code>plot.background</code>: (<code>element_rect</code>; inherits from <code>rect</code>)</dd>
<dd><code>plot.title</code>: (<code>element_text</code>; inherits from <code>title</code>)</dd>
<dd><code>plot.subtitle</code>: (<code>element_text</code>; inherits from <code>title</code>)</dd>
<dd><code>plot.caption</code>: (<code>element_text</code>; inherits from <code>title</code>)</dd>
<dd><code>plot.margin</code>: (<code>unit</code> with the sizes of the top, right, bottom, and left margins)</dd>
<dt><code>facet</code> したときのラベル</dt>
<dd><code>strip.background</code>: (<code>element_rect</code>; inherits from <code>rect</code>)</dd>
<dd><code>strip.placement</code>: (&lsquo;inside&rsquo;, &lsquo;outside&rsquo;)</dd>
<dd><code>strip.text</code>: (<code>element_text</code>; inherits from <code>text</code>)<br>
&emsp;<code>__.x</code>, <code>__.y</code></dd>
<dt>その他</dt>
<dd><code>complete</code>: 部分的な変更か、完全なテーマか (<code>FALSE</code>)</dd>
<dd><code>validate</code>: 毎回チェックするか (<code>TRUE</code>)</dd>
</dl>

<h3 id="エレメント">エレメント</h3>

<dl>
<dt><code>element_rect(fill, colour, size, linetype, inherit.blank)</code> &mdash; 長方形</dt>
<dd><code>fill</code>: 塗りつぶしの色</dd>
<dd><code>colour</code>: 枠の色</dd>
</dl>

<p><code>element_line(colour, size, linetype, lineend, arrow, inherit.blank)</code> &mdash; 直線</p>

<dl>
<dt><code>element_text(family, face, colour, size, hjust, vjust, angle, lineheight, margin)</code> &mdash; 文字</dt>
<dd><code>family</code>: フォントファミリー。 空なら <code>theme_bw(base_family=...)</code> などの指定を継承。</dd>
<dd><code>face</code>: (<code>'plain'</code>, <code>'italic'</code>, <code>'bold'</code>, <code>'bold.italic'</code>)</dd>
<dd><code>hjust</code>, <code>vjust</code>: 水平位置と垂直位置の寄せ方をそれぞれ <code>[0, 1]</code> の実数で。</dd>
<dd><code>angle</code>: 角度 <code>[0, 360]</code></dd>
<dd><code>margin</code>: スペース調整を関数 <code>margin(top, right, bottom, left)</code> 越しに。</dd>
<dt><code>element_blank()</code> &mdash; 空</dt>
<dd><p>消したい要素にはこれを指定する</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">gp <span class="o">=</span> gp <span class="o">+</span> theme<span class="p">(</span>axis.ticks<span class="o">=</span>element_blank<span class="p">())</span>
gp <span class="o">=</span> gp <span class="o">+</span> theme<span class="p">(</span>panel.grid<span class="o">=</span>element_blank<span class="p">())</span></code></pre></div></dd>
<dt><code>rel(x)</code></dt>
<dd><p>デフォルトからの相対値で <code>size</code> 引数を指定したいときに。</p></dd>
<dt><code>grid::unit(x, units, data=NULL)</code></dt>
<dd><p>こちらは絶対指定。<code>grid</code> パッケージに入ってる。
units で使いそうなのは
<code>cm</code>, <code>mm</code>, <code>inches</code>, <code>points</code>, <code>lines</code>, <code>native</code></p></dd>
<dt><code>grid::arrow(angle, length, ends, type)</code></dt>
<dd><p><code>axis.line</code> の <code>element_line()</code> にこれを与えて軸を矢印にするとか。</p></dd>
<dt><code>margin(t=0, r=0, b=0, l=0, unit='pt')</code></dt>
<dd><p>marginクラス</p></dd>
<dt><code>calc_element(element, theme, verbose=FALSE)</code></dt>
<dd><p>継承などを考慮した上でelementがどんな値にセットされるか確かめる。</p></dd>
</dl>

<h2 id="ファイルに書き出す">ファイルに書き出す</h2>

<p>RStudioやQuartzの保存ダイアログを利用して書き出すこともできるけど、
それだとサイズ調整やファイル名入力を手作業でやることになってしまう。
<code>ggsave()</code> をスクリプトに書いておけば何回でも同じ設定で出力できる。</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">ggsave<span class="p">(</span>filename<span class="p">,</span> plot <span class="o">=</span> last_plot<span class="p">(),</span> device <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span> path <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span>
       scale <span class="o">=</span> <span class="m">1</span><span class="p">,</span>  width <span class="o">=</span> <span class="kc">NA</span><span class="p">,</span> height <span class="o">=</span> <span class="kc">NA</span><span class="p">,</span>
       units <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#34;in&#34;</span><span class="p">,</span> <span class="s">&#34;cm&#34;</span><span class="p">,</span> <span class="s">&#34;mm&#34;</span><span class="p">),</span> dpi <span class="o">=</span> <span class="m">300</span><span class="p">,</span> limitsize <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="kc">...</span><span class="p">)</span></code></pre></div>
<ul>
<li>画像形式はファイル名の拡張子から自動的に判別される
(e.g., <code>iris.png</code>, <code>iris.pdf</code>)。</li>
<li><code>width</code>や<code>height</code>を小さくするほど、文字・点・線などの要素が相対的に大きくなる。</li>
<li><code>dpi</code>を変えることで、見た目のバランスを保ったまま解像度を変えられる。
(これはPNGなどラスタ形式だけの話。PDFなどのベクタ形式なら気にしなくていい)</li>
<li>タイトルや軸ラベルの文字サイズを変えたいときはテーマの
<code>theme_bw(base_size = 42)</code> や各要素の <code>element_text(size = 42)</code> を使う。</li>
<li>scaleやunitsを使うのは慣れてからで十分。</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="c1"># 7inch x 300dpi = 2100 ピクセル四方 (デフォルト)</span>
ggsave<span class="p">(</span><span class="s">&#39;iris1.png&#39;</span><span class="p">,</span> gp<span class="p">)</span> <span class="c1"># width = 7, height = 7, dpi = 300</span>

<span class="c1"># 4inch x 300dpi = 1200 ピクセル四方</span>
ggsave<span class="p">(</span><span class="s">&#39;iris2.png&#39;</span><span class="p">,</span> gp<span class="p">,</span> width <span class="o">=</span> <span class="m">4</span><span class="p">,</span> height <span class="o">=</span> <span class="m">4</span><span class="p">)</span> <span class="c1"># dpi = 300</span>

<span class="c1"># 同じ1200ピクセル四方で、軸ラベルなどの文字だけ大きく</span>
ggsave<span class="p">(</span><span class="s">&#39;iris3.png&#39;</span><span class="p">,</span> gp <span class="o">+</span> theme_bw<span class="p">(</span>base_size <span class="o">=</span> <span class="m">22</span><span class="p">),</span> width <span class="o">=</span> <span class="m">4</span><span class="p">,</span> height <span class="o">=</span> <span class="m">4</span><span class="p">)</span>

<span class="c1"># 同じ1200ピクセル四方で、点や線なども大きく</span>
ggsave<span class="p">(</span><span class="s">&#39;iris4.png&#39;</span><span class="p">,</span> gp<span class="p">,</span> width <span class="o">=</span> <span class="m">2</span><span class="p">,</span> height <span class="o">=</span> <span class="m">2</span><span class="p">,</span> dpi <span class="o">=</span> <span class="m">600</span><span class="p">)</span></code></pre></div>
<h2 id="extensions">Extensions</h2>

<ul>
<li><a href="https://ggplot2.tidyverse.org/articles/extending-ggplot2.html">https://ggplot2.tidyverse.org/articles/extending-ggplot2.html</a></li>
<li><a href="https://www.ggplot2-exts.org/">https://www.ggplot2-exts.org/</a></li>
</ul>

<p>ggplotを拡張するための仕組みがversion 2.0から正式に導入され、
ユーザーが独自の stats や geom を作って登録することが容易になった。</p>

<h3 id="gridextra"><code>gridExtra</code></h3>

<p><a href="https://github.com/baptiste/gridextra/wiki">https://github.com/baptiste/gridextra/wiki</a></p>

<p>データによって自動的にパネルを分割するには
<code>facet_grid()</code> や <code>facet_wrap()</code> を使えばよいが、
関係ない複数の図を1枚に描きたい場合は <code>grid</code> や <code>gtable</code> の機能を使う必要がある。
<code>gridExtra</code> はそのへんの操作を手軽にできるようにしてくれるパッケージ。</p>

<p>&ldquo;grob&rdquo; は &ldquo;grid graphical object&rdquo; の略。
ggplotオブジェクトと同じように <code>ggsave()</code> に渡して保存可能。</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">grob <span class="o">=</span> gridExtra<span class="o">::</span>arrangeGrob<span class="p">(</span>p1<span class="p">,</span> p2<span class="p">,</span> nrow<span class="o">=</span><span class="m">2</span><span class="p">,</span> ncol<span class="o">=</span><span class="m">1</span><span class="p">,</span> bottom<span class="o">=</span><span class="s">&#39;Time&#39;</span><span class="p">)</span>
grid.newpage<span class="p">()</span>
grid.draw<span class="p">(</span>grob<span class="p">)</span></code></pre></div>
<p>複数ページのPDFに書き出したい場合は
<a href="/rstats/purrr.html">purrr</a> などを使って list of ggplots を作っておき、
<code>marrangeGrob()</code> に渡す。</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="m">.</span>grobs <span class="o">=</span> purrr<span class="o">::</span>map<span class="p">(</span><span class="m">.</span>dataframes<span class="p">,</span> my_ggplot_func<span class="p">)</span>
<span class="m">.</span>gtable <span class="o">=</span> gridExtra<span class="o">::</span>marrangeGrob<span class="p">(</span><span class="m">.</span>grobs<span class="p">,</span> nrow<span class="o">=</span><span class="m">4</span><span class="p">,</span> ncol<span class="o">=</span><span class="m">3</span><span class="p">)</span>
ggsave<span class="p">(</span><span class="s">&#39;multi_page.pdf&#39;</span><span class="p">,</span> <span class="m">.</span>gtable<span class="p">,</span> width<span class="o">=</span><span class="m">7</span><span class="p">,</span> height<span class="o">=</span><span class="m">9.9</span><span class="p">)</span></code></pre></div>
<h3 id="cowplot"><code>cowplot</code></h3>

<ul>
<li><a href="https://github.com/wilkelab/cowplot">https://github.com/wilkelab/cowplot</a></li>
<li><a href="https://cran.r-project.org/web/packages/cowplot">https://cran.r-project.org/web/packages/cowplot</a></li>
</ul>

<p>ggplotを学術論文向けにカスタマイズしやすくする。
主な利用目的はgridExtraと同じでggplotを並べる機能。
ABCのようなラベルをオプションで簡単に付けられるのが良い。</p>

<dl>
<dt><code>cowplot::plot_grid()</code></dt>
<dd><p><code>facet_wrap()</code>のように、ざっと並べるのに便利。
もちろん入れ子も可能。</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r">cowplot<span class="o">::</span>plot_grid<span class="p">(</span><span class="kc">...</span><span class="p">,</span> plotlist<span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
    align<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="s">&#39;none&#39;</span><span class="p">,</span> <span class="s">&#39;h&#39;</span><span class="p">,</span> <span class="s">&#39;v&#39;</span><span class="p">,</span> <span class="s">&#39;hv&#39;</span><span class="p">),</span>
    nrow<span class="o">=</span><span class="kc">NULL</span><span class="p">,</span> ncol<span class="o">=</span><span class="kc">NULL</span><span class="p">,</span>
    scale<span class="o">=</span><span class="m">1</span><span class="p">,</span> rel_widths<span class="o">=</span><span class="m">1</span><span class="p">,</span> rel_heights<span class="o">=</span><span class="m">1</span><span class="p">,</span>
    labels<span class="o">=</span><span class="kc">NULL</span><span class="p">,</span> label_size<span class="o">=</span><span class="m">14</span><span class="p">,</span>
    hjust<span class="o">=</span><span class="m">-0.5</span><span class="p">,</span> vjust<span class="o">=</span><span class="m">1.5</span><span class="p">)</span></code></pre></div>
<p>さらに細やかな制御をしたいときは以下の関数を個別に重ねていく。</p></dd>
<dt><code>cowplot::ggdraw(plot=NULL, xlim=c(0, 1), ylim=c(0, 1))</code></dt>
<dd><p>これの後ろに <code>+</code> 演算子で <code>draw_***()</code> を足していく。</p></dd>
<dt><code>cowplot::get_legend(plot)</code></dt>
<dd><p>凡例が共通する図を並べるとき、代表のやつをこれで取っておいてあとで並べる。</p></dd>
</dl>

<p><code>draw_figure_label()</code>
<code>draw_grob()</code>
<code>draw_label()</code>
<code>draw_line()</code>
<code>draw_plot()</code>
<code>draw_plot_label()</code>
<code>draw_text()</code></p>

<p><code>theme_cowplot()</code>
<code>ggsave2()</code></p>

<p>パッケージ読み込みと同時に勝手にテーマを変更したり、
<code>ggsave()</code> 関数を上書きしたりという問題が過去にはあったが、今は大丈夫。</p>

<h2 id="関連書籍">関連書籍</h2>

<p><a href="https://www.amazon.co.jp/dp/331924275X/ref=as_li_ss_il?ie=UTF8&qid=1508463669&sr=8-2&keywords=ggplot2&linkCode=li3&tag=heavywatal-22&linkId=4880b062b674960adf66dab4707eed01" target="_blank"><img border="0" src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=331924275X&Format=_SL250_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=heavywatal-22" ></a><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=heavywatal-22&l=li3&o=9&a=331924275X" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
<a href="https://www.amazon.co.jp/dp/4873116538/ref=as_li_ss_il?ie=UTF8&linkCode=li3&tag=heavywatal-22&linkId=27fae9b2fd078aeba62baef727299bdd" target="_blank"><img border="0" src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=4873116538&Format=_SL250_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=heavywatal-22" ></a><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=heavywatal-22&l=li3&o=9&a=4873116538" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
<a href="https://www.amazon.co.jp/dp/487311814X/ref=as_li_ss_il?ie=UTF8&qid=1508340144&sr=8-1&keywords=r&linkCode=li3&tag=heavywatal-22&linkId=4137d3d3351f8ccab5a93cefdc28fdec" target="_blank"><img border="0" src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=487311814X&Format=_SL250_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=heavywatal-22" ></a><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=heavywatal-22&l=li3&o=9&a=487311814X" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></p>

</article>
</main>

<nav class="menu">

<div><a href="/about.html">About</a></div>

<div><a href="/research.html">Research Interests</a></div>

<input type="checkbox" id="menu-rstats" checked>
<label for="menu-rstats" class="active">R stats</label>
<ul>
<li><a href="/rstats/intro.html">R自学自習の基礎知識</a></li>
<li><a href="/rstats/programming.html">RプログラミングTips</a></li>
<li><a href="/rstats/config.html">R環境設定</a></li>
<li class="active"><a href="/rstats/ggplot2.html">ggplot2</a></li>
<li><a href="/rstats/dplyr.html">dplyr</a></li>
<li><a href="/rstats/purrr.html">purrr</a></li>
<li><a href="/rstats/tidyr.html">tidyr</a></li>
<li><a href="/rstats/readr.html">readr</a></li>
<li><a href="/rstats/stringr.html">stringr</a></li>
<li><a href="/rstats/foreach.html">foreach/parallel</a></li>
<li><a href="/rstats/devtools.html">devtools</a></li>
<li><a href="/rstats/bioconductor.html">Bioconductor</a></li>
<li><a href="/rstats/rtracklayer.html">rtracklayer</a></li>
<li><a href="/rstats/biomart.html">biomaRt</a></li>
<li><a href="/rstats/ggbio.html">ggbio</a></li>
<li><a href="/rstats/edger.html">edgeR</a></li>
<li><a href="/rstats/topgo.html">topGO</a></li>
<li><a href="/rstats/stan.html">Stan</a></li>
<li><a href="/rstats/rgl.html">rgl</a></li>
<li><a href="/rstats/plyr.html">plyr</a></li>
<li><a href="/rstats/reshape2.html">reshape2</a></li>
</ul>

<input type="checkbox" id="menu-python">
<label for="menu-python">Python</label>
<ul>
<li><a href="/python/install.html">Pythonインストール</a></li>
<li><a href="/python/pip.html">pip</a></li>
<li><a href="/python/ipython.html">IPython</a></li>
<li><a href="/python/biopython.html">BioPython</a></li>
<li><a href="/python/scipy.html">NumPy, SciPy</a></li>
<li><a href="/python/pandas.html">Pandas</a></li>
<li><a href="/python/pyqt.html">PyQt</a></li>
<li><a href="/python/concurrent.html">concurrent.futures</a></li>
<li><a href="/python/copy.html">copy</a></li>
<li><a href="/python/matplotlib.html">matplotlib &#43; seaborn</a></li>
<li><a href="/python/setuptools.html">setuptools</a></li>
</ul>

<input type="checkbox" id="menu-cxx">
<label for="menu-cxx">C&#43;&#43;</label>
<ul>
<li><a href="/cxx/boost.html">Boost</a></li>
<li><a href="/cxx/getopt.html">C&#43;&#43;コマンドライン引数</a></li>
<li><a href="/cxx/speed.html">C&#43;&#43;高速化</a></li>
<li><a href="/cxx/clang.html">clang / llvm</a></li>
<li><a href="/cxx/gcc.html">gcc</a></li>
<li><a href="/cxx/bitwise.html">ビット演算</a></li>
<li><a href="/cxx/random.html">擬似乱数生成器</a></li>
</ul>

<input type="checkbox" id="menu-bio">
<label for="menu-bio">Biology</label>
<ul>
<li><a href="/bio/blast.html">BLAST</a></li>
<li><a href="/bio/gene_ontology.html">Gene Ontology</a></li>
<li><a href="/bio/meme.html">MEME</a></li>
<li><a href="/bio/popgen.html">Population Genetics</a></li>
<li><a href="/bio/repeatmasker.html">RepeatMasker</a></li>
<li><a href="/bio/samtools.html">SAMtools</a></li>
<li><a href="/bio/stochastic_process.html">Stochastic Process</a></li>
<li><a href="/bio/dadi.html">dadi</a></li>
<li><a href="/bio/mathmorph.html">数理形態学</a></li>
<li><a href="/bio/linear_algebra.html">線形代数</a></li>
<li><a href="/bio/complexnetwork.html">複雑ネットワーク</a></li>
<li><a href="/bio/nig.html">遺伝研スパコン</a></li>
<li><a href="/bio/motif.html">配列モチーフ探索</a></li>
</ul>

<input type="checkbox" id="menu-dev">
<label for="menu-dev">Developer Tools</label>
<ul>
<li><a href="/dev/atom.html">Atom</a></li>
<li><a href="/dev/cmake.html">CMake</a></li>
<li><a href="/dev/emacs.html">Emacs</a></li>
<li><a href="/dev/git.html">Git</a></li>
<li><a href="/dev/hugo.html">Hugo</a></li>
<li><a href="/dev/mercurial.html">Mercurial</a></li>
<li><a href="/dev/qt.html">Qt</a></li>
<li><a href="/dev/torque.html">TORQUE</a></li>
<li><a href="/dev/tex.html">TeX</a></li>
<li><a href="/dev/autotools.html">autoconf, automake</a></li>
<li><a href="/dev/make.html">make</a></li>
<li><a href="/dev/mount.html">mount</a></li>
<li><a href="/dev/nano.html">nano</a></li>
<li><a href="/dev/rsync.html">rsync</a></li>
<li><a href="/dev/ssh.html">ssh</a></li>
<li><a href="/dev/tmux.html">tmux</a></li>
<li><a href="/dev/vi.html">vi</a></li>
<li><a href="/dev/zsh.html">zsh</a></li>
<li><a href="/dev/sh.html">シェルスクリプト</a></li>
<li><a href="/dev/nohup.html">プロセス管理</a></li>
<li><a href="/dev/devenv.html">開発環境</a></li>
</ul>

<input type="checkbox" id="menu-mac">
<label for="menu-mac">Mac</label>
<ul>
<li><a href="/mac/applescript.html">AppleScript</a></li>
<li><a href="/mac/homebrew.html">Homebrew</a></li>
<li><a href="/mac/keyboard.html">Keyboard</a></li>
<li><a href="/mac/macports.html">MacPorts</a></li>
<li><a href="/mac/command.html">Mac固有コマンド</a></li>
<li><a href="/mac/quicklook.html">QuickLook</a></li>
<li><a href="/mac/spotlight.html">Spotlight</a></li>
<li><a href="/mac/winebottler.html">WineBottler</a></li>
<li><a href="/mac/kotoeri.html">ことえり</a></li>
</ul>

<input type="checkbox" id="menu-lectures">
<label for="menu-lectures">Lectures</label>
<ul>
<li><a href="/lectures/verhoef_comm_ecol-11.html">Community Ecology 輪読会 11章</a></li>
<li><a href="/lectures/prml-11-1.html">PRML輪読会 11章1節</a></li>
<li><a href="/lectures/prml-2-1.html">PRML輪読会 2章前半</a></li>
<li><a href="/lectures/prml-3-4.html">PRML輪読会 3章4節</a></li>
<li><a href="/lectures/wakeley-2-2.html">Wakeley輪読会 2章2節</a></li>
</ul>

<input type="checkbox" id="menu-misc">
<label for="menu-misc">Miscellaneous</label>
<ul>
<li><a href="/misc/fonts.html">Fonts</a></li>
<li><a href="/misc/mailman.html">Mailman</a></li>
<li><a href="/misc/vnc.html">VNCによる画面共有</a></li>
<li><a href="/misc/virtualbox.html">VirtualBox</a></li>
</ul>

<div><a href="/tags.html">Tags</a></div>
</nav>
<footer><small>(ɔ) 2008 岩嵜航 Watal M. Iwasaki</small></footer>
</body>
</html>

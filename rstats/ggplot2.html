<!doctype html>
<html ⚡ lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<link rel="canonical" href="/rstats/ggplot2.html">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400italic,700,700italic%7CUbuntu+Mono:400,400italic,700,700italic">
<link rel="stylesheet" href="/css/theme.css">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="icon" href="/favicon-192x192.png" sizes="192x192">
<link rel="apple-touch-icon" href="/favicon-192x192.png" sizes="192x192">
<style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
<script async src="https://cdn.ampproject.org/v0.js"></script>
<title>ggplot2: きれいなグラフを簡単に合理的に - Watal M. Iwasaki</title>
<meta name="author" content="Watal M. Iwasaki">
<meta name="generator" content="Hugo 0.17" />
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  displayAlign: "left",
  displayIndent: "2em",
  tex2jax: {
    inlineMath: [['$','$']],
    displayMath: [['$$','$$']],
    processEnvironments: false
  }
});
MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for(i = 0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.classList.add('has-jax');
  }
});
</script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML"></script>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-41178626-2', 'auto');
ga('send', 'pageview');
</script>

</head>
<body><div class="container">
<header><h1><a href="/">
<img class="logo" src="/favicon-192x192.png" alt="岩嵜航">
Watal M. Iwasaki
</a></h1>
<form class="cse-search-box" action="/search.html">
  <input type="text" name="q" required>
</form>
</header>

<main>
<article>
<header><h1><a href=".">
ggplot2 — きれいなグラフを簡単に合理的に
</a></h1>
<ul class="tags">
<li><a href="/tags/r">r</a></li>
<li><a href="/tags/graph">graph</a></li>
<li><a href="/tags/tidyverse">tidyverse</a></li>
</ul>
</header>



<ul>
<li><a href="http://r4ds.had.co.nz/data-visualisation.html">http://r4ds.had.co.nz/data-visualisation.html</a></li>
<li><a href="http://docs.ggplot2.org/">http://docs.ggplot2.org/</a></li>
<li><a href="http://www.cookbook-r.com/Graphs/">http://www.cookbook-r.com/Graphs/</a></li>
<li><a href="http://www.rdocumentation.org/packages/ggplot2">http://www.rdocumentation.org/packages/ggplot2</a></li>
<li><a href="https://github.com/hadley/ggplot2-book">https://github.com/hadley/ggplot2-book</a></li>
</ul>

<p><a href="https://github.com/tidyverse/tidyverse">tidyverse</a> に含まれているので、
<code>install.packages('tidyverse')</code> で一括インストール、
<code>library(tidyverse)</code> で一括ロード。</p>

<h2 id="基本的な使い方">基本的な使い方</h2>

<p>R に入ってるお馴染みサンプルデータ <code>iris</code> を使って</p>

<pre><code class="language-r">## ライブラリの読み込み
library(tidyverse)

## データと全体設定を持ったggplotオブジェクトを作る
gp = ggplot(iris, aes(x=Sepal.Width, y=Sepal.Length, colour=Species))

## グラフのレイヤーを重ねる
gp = gp + geom_point(size=3, alpha=0.7)

## 描画してみる
print(gp)

## さらにグラフを重ねたり、タイトルやテーマの設定をしたり
gp = gp + geom_smooth(method=glm, family=gaussian)
gp = gp + labs(title=&quot;Iris Sepal&quot;)
gp = gp + theme_bw()
gp = gp + theme(panel.grid.minor=element_blank())
print(gp)

## ファイルに保存
ggsave(&quot;iris_sepal.png&quot;, gp)
</code></pre>

<div class="note">
<p><code>ggplot()</code> に渡すデータを整形するには
<a href="/rstats/dplyr.html">dplyr</a> と <a href="/rstats/tidyr.html">tidyr</a> を使う。</p>

</div>


<h2 id="プロットの種類">プロットの種類</h2>

<p><a href="https://blog.rstudio.org/2015/12/21/ggplot2-2-0-0/">version 2.0での変更点</a></p>

<dl>
<dt><a href="http://docs.ggplot2.org/current/geom_point.html">散布図</a></dt>
<dd><code>gp + geom_point(size=2, alpha=0.3)</code></dd>
<dt><a href="http://docs.ggplot2.org/current/geom_path.html">折れ線グラフ</a></dt>
<dd><code>gp + geom_path(size=2, linetype=&quot;dashed&quot;)</code> データ順に結ぶ<br>
<code>gp + geom_line()</code> x軸上の順で結ぶ<br>
<code>gp + geom_step()</code> 階段状に結ぶ</dd>
<dt><a href="http://docs.ggplot2.org/current/geom_histogram.html">ヒストグラム、密度曲線</a></dt>
<dd><code>gp + geom_histogram()</code> &mdash; 棒グラフ with binning</dd>
<dd><code>gp + geom_bar()</code> &mdash; 棒グラフ without binning</dd>
<dd><code>gp + geom_freqpoly()</code> &mdash; 折れ線</dd>
<dd><code>gp + geom_density()</code> &mdash; 密度推定されたスムーズな線</dd>
<dt><a href="http://docs.ggplot2.org/current/geom_bar.html">棒グラフ</a></dt>
<dd><code>gp + geom_bar(stat='identity')</code><br>
statを指定しない場合はヒストグラムもどき(binning無しの生カウント)になる。
<code>position='dodge'</code> にすると横並び (デフォルト: <code>'stack'</code>)。</dd>
<dt><a href="http://docs.ggplot2.org/current/geom_boxplot.html">箱ひげ図</a></dt>
<dd><code>gp + geom_boxplot()</code><br>
<code>gp + geom_violin()</code></dd>
<dt><a href="http://docs.ggplot2.org/current/geom_tile.html">ヒートマップ</a></dt>
<dd><code>gp + geom_tile(aes(fill=z))</code><br>
<code>gp + geom_raster(aes(fill=z))</code><br>
後者は各タイルの大きさがすべて同じ場合の特殊ケースで、高速。</dd>
<dt><a href="http://docs.ggplot2.org/current/geom_linerange.html">エラーバー</a></dt>
<dd><code>limits = aes(ymax=height+se, ymin=height-se)</code><br>
<code>gp + geom_errorbar(limits, width=0.1)</code><br>
<code>gp + geom_pointrange(limits)</code><br>
<code>gp + geom_crossbar(limits, width=0.2)</code></dd>
<dt><a href="http://docs.ggplot2.org/current/stat_function.html">関数</a></dt>
<dd><code>ggplot(data.frame(x=c(-4, 4)), aes(x)) + stat_function(fun=dnorm, args=c(0, 1), n=200)</code></dd>
</dl>

<hr>

<dl>
<dt><a href="http://docs.ggplot2.org/current/geom_smooth.html">回帰曲線</a></dt>
<dd><code>gp + geom_smooth(method=glm, family=poisson, se=FALSE)</code></dd>
<dt><a href="http://docs.ggplot2.org/current/geom_abline.html">切片と傾きで直線を描く</a></dt>
<dd><code>gp + geom_abline(intercept=3, slope=5)</code><br>
<code>gp + geom_hline(yintercept=7) + geom_vline(xintercept=11)</code></dd>
<dt><a href="http://docs.ggplot2.org/current/geom_segment.html">始点と終点で曲線や矢印を描く</a></dt>
<dd><code>gp + geom_curve(aes(x, y, xend, yend), curvature = -0.2)</code><br>
<code>gp + geom_segment(aes(x, y, xend, yend), arrow=arrow())</code><br>
矢印の調整は <a href="http://www.inside-r.org/r-doc/grid/arrow">grid::arrow()</a></dd>
<dt><a href="http://docs.ggplot2.org/current/annotate.html">文字列や図形を書き加える</a></dt>
<dd><code>gp + geom_text(aes(y=y_val+10), label=y_val)</code><br>
<code>gp + annotate(&quot;text&quot;, x=1:4, y=4:1, label=sprintf(&quot;x = %d&quot;, 1:4))</code><br>
テーマの <code>base_family</code> は引き継がれないので <code>family=</code> で指定すべし。<br>
数式を使う場合は文字列 <code>label='italic(N[t])'</code> のような文字列で渡して <code>parse=TRUE</code>。</dd>
</dl>

<h2 id="プロットの調整">プロットの調整</h2>

<h3 id="データによって色やサイズを変える">データによって色やサイズを変える</h3>

<p><code>colour</code>: 点や線の色<br>
<code>fill</code>: 塗りつぶしの色<br>
<code>size</code>: 点や線のサイズ <a href="http://docs.ggplot2.org/current/scale_size.html">http://docs.ggplot2.org/current/scale_size.html</a><br>
<code>shape</code>: 点の形 <a href="http://docs.ggplot2.org/current/scale_shape.html">http://docs.ggplot2.org/current/scale_shape.html</a><br>
<code>linetype</code>: 線 <a href="http://docs.ggplot2.org/current/scale_linetype.html">http://docs.ggplot2.org/current/scale_linetype.html</a><br>
<code>alpha</code>: 不透明度 (0が透明、1が不透明) <a href="http://docs.ggplot2.org/current/scale_alpha.html">http://docs.ggplot2.org/current/scale_alpha.html</a></p>

<p><code>aes()</code> の中にはデータによって描き分けたい列名を指定し、
外にはデータによらない値を指定する:</p>

<pre><code># サイズは常に3、色は species という列のデータによって変える
geom_point(aes(colour=species), size=3)+
scale_colour_brewer(palette='Set1')

# 色は常に赤、サイズは frequency という列の値に比例
geom_point(aes(size=frequency), colour='red')
</code></pre>

<dl>
<dt><a href="http://docs.ggplot2.org/current/scale_brewer.html">http://docs.ggplot2.org/current/scale_brewer.html</a></dt>
<dd><a href="http://colorbrewer2.org/">Colorbrewer</a> で定義されているパレットを使う。 色盲対策もできるし、原色も出てこないのでオススメ。<br>
cf. <a href="http://www.inside-r.org/packages/cran/RColorBrewer/docs/ColorBrewer">RColorBrewer</a><br>
<code>scale_{colour/fill}_brewer(..., type='seq', palette=1, direction=1)</code>: 離散値<br>
<code>scale_{colour/fill}_distiller(...)</code>: 連続値</dd>
<dt><a href="http://docs.ggplot2.org/current/scale_gradient.html">http://docs.ggplot2.org/current/scale_gradient.html</a></dt>
<dd>グラデーションの基準色を指定する。<br>
<code>scale_{colour/fill}_gradient(..., low, high, ...)</code>: 普通の連続値に<br>
<code>scale_{colour/fill}_gradient2(..., low, mid, high, midpoint=0, ...)</code>: ある中央値を挟んで上下に分けたいとき<br>
<code>scale_{colour/fill}_gradientn(..., colours, ...)</code>: 多色のヒートマップなどに e.g., <code>colours=c('#000000', '#0000FF', '#00FFFF', '#00FF00', '#FFFF00', '#FF0000')</code></dd>
<dt><a href="http://docs.ggplot2.org/current/scale_identity.html">http://docs.ggplot2.org/current/scale_identity.html</a></dt>
<dd>データフレームに入ってる値をそのまま使う<br>
<code>scale_{colour/fill/size/shape/linetype/alpha}_identity(..., guide='none')</code></dd>
<dt><a href="http://docs.ggplot2.org/current/scale_manual.html">http://docs.ggplot2.org/current/scale_manual.html</a></dt>
<dd>値を直に指定する<br>
<code>scale_{colour/fill/size/shape/linetype/alpha}_manual(..., values)</code></dd>
</dl>

<p>legend/colourbarのタイトルを変更したい場合は上記関数に <code>name='New Title'</code> を指定する。
さらに細かく制御したい場合は
<a href="http://docs.ggplot2.org/current/guide_legend.html"><code>guide_legend()</code></a> や
<a href="http://docs.ggplot2.org/current/guide_colourbar.html"><code>guide_colourbar()</code></a>
を引数 <code>guide</code> に渡す。</p>

<h3 id="内部変数を使う">内部変数を使う</h3>

<p><a href="https://github.com/hadley/ggplot2-book/blob/master/layers.rmd#generated-variables">https://github.com/hadley/ggplot2-book/blob/master/layers.rmd#generated-variables</a></p>

<p>ヒストグラムや箱ヒゲなどの表示に必要な計算は
ggplot内部で <code>stat_*()</code> を通して行われる。
そうした値 (computed variables) の一部は
<code>..count..</code> や <code>..density..</code> みたいに
ピリオドで囲まれた特殊な名前で参照することができる。</p>

<h3 id="パネルの分割">パネルの分割</h3>

<p>年ごとや種ごとに傾向を見たいときなど、データに応じてパネルを分割して並べる。</p>

<dl>
<dt><a href="http://docs.ggplot2.org/current/facet_wrap.html"><code>facet_wrap()</code></a></dt>
<dd><p>1変数で分割して並べる</p>

<pre><code class="language-r">facet_wrap(facets, nrow=NULL, ncol=NULL, scales='fixed',
           shrink=TRUE, labeller='label_value',
           as.table=TRUE, switch=NULL, drop=TRUE)

ggplot(iris, aes(Petal.Length, Sepal.Length))+geom_point()+
    facet_wrap(~Species, nrow=2)
</code></pre></dd>
<dt><a href="http://docs.ggplot2.org/current/facet_grid.html"><code>facet_grid()</code></a></dt>
<dd><p>2変数で分割して縦横に並べる</p>

<pre><code class="language-r">facet_grid(facets, margins=FALSE, scales='fixed', space='fixed',
           shrink=TRUE, labeller='label_value',
           as.table=TRUE, switch=NULL, drop=TRUE)

ggplot(iris, aes(Petal.Length, Sepal.Length))+geom_point()+
    facet_grid(. ~ Species)
</code></pre>

<p>1変数でいい場合は片方をドット <code>.</code> で固定できる。</p></dd>
<dt><a href="http://docs.ggplot2.org/current/labellers.html">ファセットラベルの調整</a></dt>
<dd><p>デフォルトでは値だけがfacetラベルに表示されるが、
変数名を同時に表示するなど細かい調整も可能。</p></dd>
</dl>

<h3 id="軸やタイトルを変更">軸やタイトルを変更</h3>

<dl>
<dt><a href="http://docs.ggplot2.org/current/scale_continuous.html">軸の区切りを変更したり対数にしたり</a></dt>
<dd><code>gp + scale_x_continuous(breaks=seq(10, 100, by=10))</code><br>
<code>gp + scale_y_log10(&quot;Beer consumption&quot;)</code><br>
オプション: name, breaks, labels, na.value, limits, trans, expand<br>
デフォルトでは値域よりも少し余裕を持たせてあるが、 <code>geom_tile()</code> などでピッタリにしたいときは軸ごとに <code>expand=c(0, 0)</code> とか。</dd>
<dt><a href="http://docs.ggplot2.org/current/coord_cartesian.html">描画する範囲を指定</a></dt>
<dd><code>gp + ylim(0, 42) + xlim(&quot;b&quot;, &quot;c&quot;, &quot;d&quot;)</code><br>
<code>gp + coord_cartesian(xlim = NULL, ylim = NULL)</code><br>
前者はデータそのものを切るが、後者はデータを変えずに描画領域だけズームする</dd>
<dt><a href="http://docs.ggplot2.org/current/coord_fixed.html">X軸とY軸の比率を固定</a></dt>
<dd><code>gp + coord_fixed(ratio=1)</code></dd>
<dt><a href="http://docs.ggplot2.org/current/coord_flip.html">XY軸の反転</a></dt>
<dd><code>gp + coord_flip()</code></dd>
<dt><a href="http://docs.ggplot2.org/current/coord_polar.html">極座標</a></dt>
<dd>パイチャートも作れるらしい</dd>
<dt><a href="http://docs.ggplot2.org/current/coord_trans.html">座標変換</a></dt>
<dd><code>gp + coord_trans(x='log10', y='sqrt')</code><br>
表示の座標だけ変更する。
stat前に適用される <code>scale_x_*</code> とかとはちょいと違う。</dd>
<dt><a href="http://docs.ggplot2.org/current/labs.html">軸ラベルとタイトル</a></dt>
<dd><code>gp + labs(x=&quot;time&quot;, y=&quot;weight&quot;, title=&quot;growth&quot;)</code><br>
<code>gp + xlab(&quot;time&quot;) + ylab(&quot;weight&quot;) + ggtitle(&quot;growth&quot;)</code></dd>
</dl>

<h2 id="theme-背景やラベルの調整"><code>theme</code>: 背景やラベルの調整</h2>

<p><a href="http://docs.ggplot2.org/current/ggtheme.html">http://docs.ggplot2.org/current/ggtheme.html</a></p>

<h3 id="既成テーマ">既成テーマ</h3>

<dl>
<dt><code>theme_grey(base_size=12, base_family='')</code>, <code>theme_gray(...)</code></dt>
<dd>灰色背景に白い格子。<code>ggplot</code> らしいデフォルト。</dd>
<dt><code>theme_bw(...)</code></dt>
<dd>黒枠白背景にうっすら灰色格子</dd>
<dt><code>theme_linedraw(...)</code></dt>
<dd>細いけど濃い色の <code>panel.grid</code></dd>
<dt><code>theme_light(...)</code></dt>
<dd>それを薄くした感じ</dd>
<dt><code>theme_minimal(...)</code></dt>
<dd>外枠なしの <code>theme_bw</code></dd>
<dt><code>theme_classic(...)</code></dt>
<dd>xy軸がL字に描かれているだけで枠もグリッドも無し</dd>
<dt><code>theme_void(...)</code></dt>
<dd>完全に枠なし</dd>
</dl>

<p>これらをカッコ無しでコンソールに打ち込むと、
下記の各エレメントの設定方法やデフォルト値を知ることができる。</p>

<p>引数として <code>base_family</code> に&rdquo;Helvetica Neue&rdquo;などのフォントを指定できる。
Macなら&rdquo;HiraKakuProN-W3&rdquo;を指定すれば日本語でも文字化けしなくなるはず。
(<code>grDevices::quartzFonts()</code> などを <code>.Rprofile</code> に書いてフォントを登録するには
<a href="/rstats/config.html#rprofile">config</a> を参照)</p>

<p>ほかにもいろんなテーマが
<a href="https://cran.r-project.org/web/packages/ggthemes/vignettes/ggthemes.html">ggthemes</a>
というパッケージで提供されている。</p>

<div class="note">
<p>この設定はテーマを構成する <code>axis.text</code> などには引き継がれるが
<code>geom_text()</code> などプロット内部の要素には引き継がれない。</p>

</div>


<h3 id="設定項目">設定項目</h3>

<p><a href="http://docs.ggplot2.org/current/theme.html">http://docs.ggplot2.org/current/theme.html</a></p>

<p><a href="http://docs.ggplot2.org/dev/vignettes/themes.html">http://docs.ggplot2.org/dev/vignettes/themes.html</a></p>

<p><code>theme()</code> 関数に項目と値を指定したものを、
ほかのレイヤーと同じようにどんどん足しながら変更していく。
テーマは直線、長方形、文字の3種類のエレメントからなり、
それらの性質を変更する場合は <code>element_***()</code> を介して行う</p>

<pre><code class="language-r">## ベースとなるテーマを先に適用してから
gp = gp + theme_bw(base_family='HiraKakuProN-W3')
gp = gp + theme(legend.position='bottom')
gp = gp + theme(plot.background=element_rect(fill=&quot;transparent&quot;))
</code></pre>

<dl>
<dt>全体</dt>
<dd><code>line</code>: (<code>element_line</code>)</dd>
<dd><code>rect</code>: (<code>element_rect</code>)</dd>
<dd><code>text</code>: (<code>element_text</code>)</dd>
<dd><code>title</code>: (<code>element_text</code>; inherits from <code>text</code>)</dd>
<dt>軸タイトル、軸ラベル、目盛</dt>
<dd><code>axis.title</code>: (<code>element_text</code>; inherits from <code>text</code>)</dd>
<dd><code>axis.title.x</code>: (<code>element_text</code>; inherits from <code>axis.title</code>)</dd>
<dd><code>axis.title.y</code>: (<code>element_text</code>; inherits from <code>axis.title</code>)</dd>
<dd><code>axis.text</code>: (<code>element_text</code>; inherits from <code>text</code>)</dd>
<dd><code>axis.text.x</code>: (<code>element_text</code>; inherits from <code>axis.text</code>)</dd>
<dd><code>axis.text.y</code>: (<code>element_text</code>; inherits from <code>axis.text</code>)</dd>
<dd><code>axis.ticks</code>: (<code>element_line</code>; inherits from <code>line</code>)</dd>
<dd><code>axis.ticks.x</code>: (<code>element_line</code>; inherits from <code>axis.ticks</code>)</dd>
<dd><code>axis.ticks.y</code>: (<code>element_line</code>; inherits from <code>axis.ticks</code>)</dd>
<dd><code>axis.ticks.length</code>: (<code>unit</code>)</dd>
<dd><code>axis.ticks.margin</code>: (<code>unit</code>)</dd>
<dd><code>axis.line</code>: (<code>element_line</code>; inherits from <code>line</code>)</dd>
<dd><code>axis.line.x</code>: (<code>element_line</code>; inherits from <code>axis.line</code>)</dd>
<dd><code>axis.line.y</code>: (<code>element_line</code>; inherits from <code>axis.line</code>)</dd>
<dt>凡例</dt>
<dd><code>legend.background</code>: (<code>element_rect</code>; inherits from <code>rect</code>)</dd>
<dd><code>legend.margin</code>: (<code>unit</code>)</dd>
<dd><code>legend.key</code>: (<code>element_rect</code>; inherits from <code>rect</code>)</dd>
<dd><code>legend.key.size</code>: (<code>unit</code>)</dd>
<dd><code>legend.key.height</code>: (<code>unit</code>; inherits from <code>legend.key.size</code>)</dd>
<dd><code>legend.key.width</code>: (<code>unit</code>; inherits from <code>legend.key.size</code>)</dd>
<dd><code>legend.text</code>: (<code>element_text</code>; inherits from <code>text</code>)</dd>
<dd><code>legend.text.align</code>: (number from <code>0</code> (left) to <code>1</code> (right))</dd>
<dd><code>legend.title</code>: (<code>element_text</code>; inherits from <code>title</code>)</dd>
<dd><code>legend.title.align</code>: (number from <code>0</code> (left) to <code>1</code> (right))</dd>
<dd><code>legend.position</code>: (<code>&quot;left&quot;</code>, <code>&quot;right&quot;</code>, <code>&quot;bottom&quot;</code>, <code>&quot;top&quot;</code>, <code>&quot;none&quot;</code> <code>c(0, 1)</code></dd>
<dd><code>legend.direction</code>: (<code>&quot;horizontal&quot;</code> or <code>&quot;vertical&quot;</code>)</dd>
<dd><code>legend.justification</code>: (<code>&quot;center&quot;</code> or <code>c(0, 1)</code> のような数値でアンカー位置を指定)</dd>
<dd><code>legend.box</code>: (<code>&quot;horizontal&quot;</code> or <code>&quot;vertical&quot;</code>)</dd>
<dd><code>legend.box.just</code>: (<code>&quot;top&quot;</code>, <code>&quot;bottom&quot;</code>, <code>&quot;left&quot;</code>, or <code>&quot;right&quot;</code>)</dd>
<dt>プロット領域の背景、余白、格子</dt>
<dd><code>panel.background</code>: (<code>element_rect</code>; inherits from <code>rect</code>)</dd>
<dd><code>panel.border</code>: (<code>element_rect</code>; inherits from <code>rect</code>; should be used with <code>fill=NA</code>)</dd>
<dd><code>panel.margin</code>: (<code>unit</code>; <code>facet_*</code> の間隔)</dd>
<dd><code>panel.grid</code>: (<code>element_line</code>; inherits from <code>line</code>)</dd>
<dd><code>panel.grid.major</code>: (<code>element_line</code>; inherits from <code>panel.grid</code>)</dd>
<dd><code>panel.grid.minor</code>: (<code>element_line</code>; inherits from <code>panel.grid</code>)</dd>
<dd><code>panel.grid.major.x</code>: (<code>element_line</code>; inherits from <code>panel.grid.major</code>)</dd>
<dd><code>panel.grid.major.y</code>: (<code>element_line</code>; inherits from <code>panel.grid.major</code>)</dd>
<dd><code>panel.grid.minor.x</code>: (<code>element_line</code>; inherits from <code>panel.grid.minor</code>)</dd>
<dd><code>panel.grid.minor.y</code>: (<code>element_line</code>; inherits from <code>panel.grid.minor</code>)</dd>
<dt>全体の背景、タイトル、余白</dt>
<dd><code>plot.background</code>: (<code>element_rect</code>; inherits from <code>rect</code>)</dd>
<dd><code>plot.title</code>: (<code>element_text</code>; inherits from <code>title</code>)</dd>
<dd><code>plot.margin</code>: (<code>unit</code> with the sizes of the top, right, bottom, and left margins)</dd>
<dt><code>facet</code> したときのラベル</dt>
<dd><code>strip.background</code>: (<code>element_rect</code>; inherits from <code>rect</code>)</dd>
<dd><code>strip.text</code>: (<code>element_text</code>; inherits from <code>text</code>)</dd>
<dd><code>strip.text.x</code>: (<code>element_text</code>; inherits from <code>strip.text</code>)</dd>
<dd><code>strip.text.y</code>: (<code>element_text</code>; inherits from <code>strip.text</code>)</dd>
</dl>

<h3 id="エレメント">エレメント</h3>

<p><code>element_line(colour, size, linetype, lineend)</code> &mdash; 直線</p>

<dl>
<dt><code>element_rect(fill, colour, size, linetype)</code> &mdash; 長方形</dt>
<dd><code>fill</code>: 塗りつぶしの色<br>
<code>colour</code>: 枠の色</dd>
<dt><code>element_text(family, face, colour, size, hjust, vjust, angle, lineheight, margin)</code> &mdash; 文字</dt>
<dd><code>family</code>: フォントファミリー。 空なら <code>theme_bw(base_family=...)</code> などの指定を継承。<br>
<code>face</code>: (<code>'plain'</code>, <code>'italic'</code>, <code>'bold'</code>, <code>'bold.italic'</code>)<br>
<code>hjust</code>, <code>vjust</code>: 水平位置と垂直位置の寄せ方をそれぞれ <code>[0, 1]</code> の実数で。<br>
<code>angle</code>: 角度 <code>[0, 360]</code><br>
<code>margin</code>: スペース調整を関数 <code>margin(top, right, bottom, left)</code> 越しに。</dd>
<dt><code>element_blank()</code> &mdash; 空</dt>
<dd>消したい要素にはこれを指定する
<code>r
gp = gp + theme(axis.title=element_blank())
gp = gp + theme(panel.grid=element_blank())
</code></dd>
<dt><code>rel(x)</code></dt>
<dd>デフォルトからの相対値で <code>size</code> 引数を指定したいときに。</dd>
<dt><code>grid::unit(x, units, data=NULL)</code></dt>
<dd>こちらは絶対指定。<code>grid</code> パッケージに入ってる。
units で使いそうなのは
<code>cm</code>, <code>mm</code>, <code>inches</code>, <code>points</code>, <code>lines</code>, <code>native</code></dd>
<dt><code>calc_element(element, theme, verbose=FALSE)</code></dt>
<dd>継承などを考慮した上でelementがどんな値にセットされるか確かめる。</dd>
<dt><a href="http://www.cookbook-r.com/Graphs/Shapes_and_line_types/">線の種類</a> &mdash; <code>linetype=</code></dt>
<dd><code>0</code>: <code>'blank'</code><br>
<code>1</code>: <code>'solid'</code><br>
<code>2</code>: <code>'dashed'</code><br>
<code>3</code>: <code>'dotted'</code><br>
<code>4</code>: <code>'dotdash'</code><br>
<code>5</code>: <code>'longdash'</code><br>
<code>6</code>: <code>'twodash'</code></dd>
</dl>

<h2 id="ファイルに書き出す">ファイルに書き出す</h2>

<pre><code class="language-r">ggsave(filename = default_name(plot), plot = last_plot(),
    device = default_device(filename), path = NULL, scale = 1,
    width = par(&quot;din&quot;)[1], height = par(&quot;din&quot;)[2],
    units = c(&quot;in&quot;, &quot;cm&quot;, &quot;mm&quot;), dpi = 300, limitsize = TRUE, ...)
</code></pre>

<p>サイズを変えるには scale, width, height, units, dpi をいじる。
デフォルトはそれぞれ 1, 7, 7, &lsquo;in&rsquo;, 300 で、1辺177.8mmの正方形に2100x2100ピクセル並べるイメージ。
A4 PDFにするなら <code>ggsave('fig1.pdf', gp, width=8.27, height=11.7)</code> とか
<code>ggsave('fig1.pdf', gp, width=210, height=297, units='mm')</code> とか。
画像形式はファイル名の拡張子から自動的に判別される。</p>

<div class="note">
<p><code>width</code> と <code>height</code> が省略されると <code>par(&quot;din&quot;)</code> が呼び出される。
Rscript から実行してるのに白いQuartzウィンドウが出現したり、
空の <code>Rplots.pdf</code> ができたりするのはこのせい。</p>

</div>


<p>MacのQuartzで調整して、そこで見たままを保存したい場合は</p>

<pre><code class="language-r">dev.off()
quartz(width=9.9, height=7)
print(gp)
quartz.save('plot.png')
</code></pre>

<h2 id="extensions">Extensions</h2>

<p>ggplotを拡張するための仕組みがversion 2.0から正式に導入され、
ユーザーが独自の stats や geom を作って登録することが容易になった。</p>

<p><a href="http://www.ggplot2-exts.org/">http://www.ggplot2-exts.org/</a></p>

<h3 id="gridextra"><code>gridExtra</code></h3>

<p><a href="https://github.com/baptiste/gridextra/wiki">https://github.com/baptiste/gridextra/wiki</a></p>

<p>データによって自動的にパネルを分割するには
<code>facet_grid()</code> や <code>facet_wrap()</code> を使えばよいが、
関係ない複数の図を1枚に描きたい場合は <code>grid</code> や <code>gtable</code> の機能を使う必要がある。
<code>gridExtra</code> はそのへんの操作を手軽にできるようにしてくれるパッケージ。</p>

<p>&ldquo;grob&rdquo; は &ldquo;grid graphical object&rdquo; の略。
ggplotオブジェクトと同じように <code>ggsave()</code> に渡して保存可能。</p>

<pre><code class="language-r">grob = gridExtra::arrangeGrob(p1, p2, nrow=2, ncol=1, bottom='Time')
grid.newpage()
grid.draw(grob)
</code></pre>

<p>複数ページのPDFに書き出したい場合は
<a href="/rstats/purrr.html">purrr</a> などを使って list of ggplots を作っておき、
<code>marrangeGrob()</code> に渡す。</p>

<pre><code class="language-r">.grobs = purrr::map(.dataframes, my_ggplot_func)
.gtable = gridExtra::marrangeGrob(.grobs, nrow=4, ncol=3)
ggsave('multi_page.pdf', .gtable, width=7, height=9.9)
</code></pre>

<h3 id="cowplot"><code>cowplot</code></h3>

<ul>
<li><a href="https://github.com/wilkelab/cowplot">https://github.com/wilkelab/cowplot</a></li>
<li><a href="https://cran.r-project.org/web/packages/cowplot">https://cran.r-project.org/web/packages/cowplot</a></li>
</ul>

<p>ggplotを学術論文向けにカスタマイズしやすくする。
主な利用目的はgridExtraと同じでggplotを並べる機能。
ラベル(e.g., A, B, C)をオプションで簡単に付けられるのが良い。</p>

<div class="warning">
<p><code>library(cowplot)</code> せずに <code>loadNamespace('cowplot')</code>
して常に名前空間つきで呼んだほうが安全。</p>

<ul>
<li><code>cowplot::ggsave()</code>が定義されてて<code>ggplot2</code>と衝突するのが気持ち悪い。</li>
<li><code>.onAttach()</code> で基本テーマが勝手に変更されるのが気持ち悪い。
<code>theme_cowplot()</code> そのものはシンプルで良くできているが、
カスタマイズのベースとするには扱いにくい
(<code>rect</code>に変なデフォルト値が設定されてしまう、など)。</li>
</ul>

</div>


<dl>
<dt><code>cowplot::plot_grid()</code></dt>
<dd><p><code>facet_wrap()</code>のように、ざっと並べるのに便利。</p>

<pre><code class="language-r">corplot::plot_grid(..., plotlist=NULL,
    align=c('none', 'h', 'v', 'hv'),
    nrow=NULL, ncol=NULL,
    scale=1, rel_widths=1, rel_heights=1,
    labels=NULL, label_size=14,
    hjust=-0.5, vjust=1.5)
</code></pre>

<p>さらに細やかな制御をしたいときは以下の関数を個別に重ねていく。</p></dd>
<dt><code>cowplot::ggdraw(plot=NULL, xlim=c(0, 1), ylim=c(0, 1))</code></dt>
<dd><p>これの後ろに <code>+</code> 演算子で <code>draw_***()</code> を足していく。</p></dd>
</dl>

<p><code>draw_figure_label()</code>
<code>draw_grob()</code>
<code>draw_label()</code>
<code>draw_line()</code>
<code>draw_plot()</code>
<code>draw_plot_label()</code>
<code>draw_text()</code></p>

<h3 id="ggally"><code>GGally</code></h3>

<p><a href="http://cran.r-project.org/web/packages/GGally/">http://cran.r-project.org/web/packages/GGally/</a></p>

<p><code>graphics::pairs()</code> のような plot matrix を <code>ggplot2</code> で作るためのパッケージ。
そもそもデータをザッと俯瞰するためのものであり、
レイヤーを重ねて変更を加えていくようなものでもないので、
<code>ggplot2</code> である恩恵はそこまでない。
でもまあ <code>pairs(iris)</code> よりは <code>ggpairs(iris, colour=Species)</code>
のほうが見やすいのは確か。</p>

<pre><code class="language-r">GGally::ggpairs(data, columns=1:ncol(data), title='',
    upper=list(), lower=list(), diag=list(), params=NULL, ...,
    axisLabels='internal', legends=FALSE, verbose=FALSE)
</code></pre>

<h2 id="関連書籍">関連書籍</h2>

<p><a href="https://www.amazon.co.jp/R%E3%82%B0%E3%83%A9%E3%83%95%E3%82%A3%E3%83%83%E3%82%AF%E3%82%B9%E3%82%AF%E3%83%83%E3%82%AF%E3%83%96%E3%83%83%E3%82%AF-_ggplot2%E3%81%AB%E3%82%88%E3%82%8B%E3%82%B0%E3%83%A9%E3%83%95%E4%BD%9C%E6%88%90%E3%81%AE%E3%83%AC%E3%82%B7%E3%83%94%E9%9B%86-Winston-Chang/dp/4873116538/ref=as_li_ss_il?ie=UTF8&linkCode=li3&tag=heavywatal-22&linkId=911c7022439b7b328c58e0168e4c66e7" target="_blank"><img border="0" src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=4873116538&Format=_SL250_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=heavywatal-22" ></a><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=heavywatal-22&l=li3&o=9&a=4873116538" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />
<a href="https://www.amazon.co.jp/%E3%82%B0%E3%83%A9%E3%83%95%E3%82%A3%E3%83%83%E3%82%AF%E3%82%B9%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AER%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0-H-%E3%82%A6%E3%82%A3%E3%83%83%E3%82%AB%E3%83%A0/dp/4621061356/ref=as_li_ss_il?ie=UTF8&linkCode=li3&tag=heavywatal-22&linkId=5ef26b015fb6a8298b410cf9feafb728" target="_blank"><img border="0" src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=4621061356&Format=_SL250_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=heavywatal-22" ></a><img src="https://ir-jp.amazon-adsystem.com/e/ir?t=heavywatal-22&l=li3&o=9&a=4621061356" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></p>

</article>
</main>

<nav class="menu">

<div><a href="/about.html">About</a></div>


<div><a href="/research.html">Research Interests</a></div>


<input type="checkbox" id="menu-rstats" checked>
<label for="menu-rstats" class="active">R stats</label>
<ul>
<li><a href="/rstats/intro.html">R自学自習の基礎知識</a></li>
<li><a href="/rstats/config.html">R環境設定</a></li>
<li><a href="/rstats/programming.html">RプログラミングTips</a></li>
<li class="active"><a href="/rstats/ggplot2.html">ggplot2</a></li>
<li><a href="/rstats/dplyr.html">dplyr</a></li>
<li><a href="/rstats/purrr.html">purrr</a></li>
<li><a href="/rstats/tidyr.html">tidyr</a></li>
<li><a href="/rstats/readr.html">readr</a></li>
<li><a href="/rstats/stringr.html">stringr</a></li>
<li><a href="/rstats/foreach.html">foreach/parallel</a></li>
<li><a href="/rstats/devtools.html">devtools</a></li>
<li><a href="/rstats/bioconductor.html">Bioconductor</a></li>
<li><a href="/rstats/rtracklayer.html">rtracklayer</a></li>
<li><a href="/rstats/biomart.html">biomaRt</a></li>
<li><a href="/rstats/ggbio.html">ggbio</a></li>
<li><a href="/rstats/edger.html">edgeR</a></li>
<li><a href="/rstats/topgo.html">topGO</a></li>
<li><a href="/rstats/stan.html">Stan</a></li>
<li><a href="/rstats/rgl.html">rgl</a></li>
<li><a href="/rstats/rjags.html">rjags</a></li>
<li><a href="/rstats/plyr.html">plyr</a></li>
<li><a href="/rstats/reshape2.html">reshape2</a></li>
</ul>

<input type="checkbox" id="menu-python">
<label for="menu-python">Python</label>
<ul>
<li><a href="/python/install.html">Installation</a></li>
<li><a href="/python/pip.html">pip</a></li>
<li><a href="/python/ipython.html">IPython</a></li>
<li><a href="/python/biopython.html">BioPython</a></li>
<li><a href="/python/egglib.html">EggLib</a></li>
<li><a href="/python/scipy.html">NumPy, SciPy</a></li>
<li><a href="/python/pyqt.html">PyQt</a></li>
<li><a href="/python/copy.html">copy</a></li>
<li><a href="/python/matplotlib.html">matplotlib &#43; seaborn</a></li>
<li><a href="/python/rpy2.html">rpy2</a></li>
</ul>

<input type="checkbox" id="menu-cxx">
<label for="menu-cxx">C&#43;&#43;</label>
<ul>
<li><a href="/cxx/boost.html">Boost</a></li>
<li><a href="/cxx/getopt.html">C&#43;&#43;コマンドライン引数</a></li>
<li><a href="/cxx/speed.html">C&#43;&#43;高速化</a></li>
<li><a href="/cxx/clang.html">clang / llvm</a></li>
<li><a href="/cxx/gcc.html">gcc</a></li>
<li><a href="/cxx/random.html">擬似乱数生成器</a></li>
</ul>

<input type="checkbox" id="menu-bio">
<label for="menu-bio">Biology</label>
<ul>
<li><a href="/bio/blast.html">BLAST</a></li>
<li><a href="/bio/dnasp.html">DnaSP</a></li>
<li><a href="/bio/emboss.html">EMBOSS</a></li>
<li><a href="/bio/ensembl.html">Ensembl</a></li>
<li><a href="/bio/gene_ontology.html">Gene Ontology</a></li>
<li><a href="/bio/meme.html">MEME</a></li>
<li><a href="/bio/mrbayes.html">MrBayes</a></li>
<li><a href="/bio/paml.html">PAML</a></li>
<li><a href="/bio/popgen.html">Population Genetics</a></li>
<li><a href="/bio/repeatmasker.html">RepeatMasker</a></li>
<li><a href="/bio/samtools.html">SAMtools</a></li>
<li><a href="/bio/stochastic_process.html">Stochastic Process</a></li>
<li><a href="/bio/dadi.html">dadi</a></li>
<li><a href="/bio/mathmorph.html">数理形態学</a></li>
<li><a href="/bio/linear_algebra.html">線形代数</a></li>
<li><a href="/bio/complexnetwork.html">複雑ネットワーク</a></li>
<li><a href="/bio/nig.html">遺伝研スパコン</a></li>
<li><a href="/bio/motif.html">配列モチーフ探索</a></li>
</ul>

<input type="checkbox" id="menu-dev">
<label for="menu-dev">Developer Tools</label>
<ul>
<li><a href="/dev/etc.html">/etc</a></li>
<li><a href="/dev/atom.html">Atom</a></li>
<li><a href="/dev/emacs.html">Emacs</a></li>
<li><a href="/dev/git.html">Git</a></li>
<li><a href="/dev/hugo.html">Hugo</a></li>
<li><a href="/dev/mercurial.html">Mercurial</a></li>
<li><a href="/dev/mysql.html">MySQL</a></li>
<li><a href="/dev/qt.html">Qt</a></li>
<li><a href="/dev/sh.html">Shell Script</a></li>
<li><a href="/dev/torque.html">TORQUE</a></li>
<li><a href="/dev/tex.html">TeX</a></li>
<li><a href="/dev/autotools.html">autoconf, automake</a></li>
<li><a href="/dev/make.html">make</a></li>
<li><a href="/dev/mount.html">mount</a></li>
<li><a href="/dev/nano.html">nano</a></li>
<li><a href="/dev/rsync.html">rsync</a></li>
<li><a href="/dev/ssh.html">ssh</a></li>
<li><a href="/dev/sshfs.html">sshfs</a></li>
<li><a href="/dev/tmux.html">tmux</a></li>
<li><a href="/dev/vi.html">vi</a></li>
<li><a href="/dev/zsh.html">zsh</a></li>
<li><a href="/dev/nohup.html">プロセス管理</a></li>
<li><a href="/dev/devenv.html">開発環境</a></li>
</ul>

<input type="checkbox" id="menu-linux">
<label for="menu-linux">Linux</label>
<ul>
<li><a href="/linux/centos.html">CentOS 6.5</a></li>
<li><a href="/linux/japanese.html">Linux日本語環境</a></li>
<li><a href="/linux/apt.html">apt/dpkg</a></li>
<li><a href="/linux/ufw.html">ufw</a></li>
</ul>

<input type="checkbox" id="menu-mac">
<label for="menu-mac">Mac</label>
<ul>
<li><a href="/mac/applescript.html">AppleScript</a></li>
<li><a href="/mac/homebrew.html">Homebrew</a></li>
<li><a href="/mac/keyboard.html">Keyboard</a></li>
<li><a href="/mac/command.html">Mac Command</a></li>
<li><a href="/mac/macports.html">MacPorts</a></li>
<li><a href="/mac/quicklook.html">QuickLook</a></li>
<li><a href="/mac/spotlight.html">Spotlight</a></li>
<li><a href="/mac/winebottler.html">WineBottler</a></li>
<li><a href="/mac/kotoeri.html">ことえり</a></li>
</ul>

<input type="checkbox" id="menu-lectures">
<label for="menu-lectures">Lectures</label>
<ul>
<li><a href="/lectures/verhoef_comm_ecol-11.html">Community Ecology 輪読会 11章</a></li>
<li><a href="/lectures/prml-11-1.html">PRML輪読会 11章1節</a></li>
<li><a href="/lectures/prml-2-1.html">PRML輪読会 2章前半</a></li>
<li><a href="/lectures/prml-3-4.html">PRML輪読会 3章4節</a></li>
<li><a href="/lectures/wakeley-2-2.html">Wakeley輪読会 2章2節</a></li>
</ul>

<input type="checkbox" id="menu-misc">
<label for="menu-misc">Miscellaneous</label>
<ul>
<li><a href="/misc/fonts.html">Fonts</a></li>
<li><a href="/misc/mailman.html">Mailman</a></li>
<li><a href="/misc/vnc.html">VNCによる画面共有</a></li>
<li><a href="/misc/virtualbox.html">VirtualBox</a></li>
</ul>

<div><a href="/tags">Tags</a></div>

</nav>




<footer>(ɔ) 2008 岩嵜航 Watal M. Iwasaki</footer>
</div>

<script src="/js/highlight.pack.js"></script>
<script>
hljs.configure({languages: ["sh","c++","python","r","tex"]});
hljs.initHighlightingOnLoad();
</script>
</body>
</html>


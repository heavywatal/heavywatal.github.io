<!doctype html>
<html lang="ja">
<head prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<title>GenomicRanges: ゲノム上の範囲やアノテーション - Heavy Watal</title>
<link rel="stylesheet" href="/css/style.css">
<link rel="icon" href="/favicon.svg">
<link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#eeeeee">
<meta name="author" content="Watal M. Iwasaki">
<meta property="og:title" content="GenomicRanges: ゲノム上の範囲やアノテーション">
<meta property="og:type" content="article">
<meta property="og:url" content="https://heavywatal.github.io/rstats/genomicranges.html">
<meta property="og:image" content="https://avatars.githubusercontent.com/heavywatal">
<meta property="og:description" content="">
<meta property="og:site_name" content="Heavy Watal">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@heavywatal">
<meta name="twitter:creator" content="@heavywatal">
<link rel="stylesheet" href="/lib/iconify.css">
<link rel="stylesheet" href="/lib/katex/katex.min.css">
<script type="module" src="/lib/katex/katex.min.js"></script>
<script type="application/ld+json">{
"@context": "http://schema.org",
"@type": "BreadcrumbList",
"itemListElement": [
 {"@type": "ListItem",
  "position": 1,
  "item": {"@id":"https://heavywatal.github.io/rstats.html","name":"rstats"} },
 {"@type": "ListItem",
  "position": 2,
  "item": {"@id":"https://heavywatal.github.io/rstats/genomicranges.html","name":"GenomicRanges"} }
]}</script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-V60H2JH0G6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-V60H2JH0G6');
</script>
</head>
<body>
<header><a href="/">
<img class="logo" src="/heavywatal.svg" alt="岩嵜航">
Heavy Watal
</a>
</header>
<main>
<article>
<header><h1><a href="/rstats/genomicranges.html">
GenomicRanges — ゲノム上の範囲やアノテーション
</a></h1>
<nav class="tags">
<a href="/tags/r.html">r</a>
<a href="/tags/bioconductor.html">bioconductor</a>
</nav>
</header>

<p><a href="https://bioconductor.org/packages/GenomicRanges">https://bioconductor.org/packages/GenomicRanges</a></p>
<p>ゲノム上の座標・範囲を表現するための型として S4 class <code>GenomicRanges</code> を提供する。
これは整数の範囲を扱う
<a href="https://bioconductor.org/packages/IRanges"><code>IRanges</code></a>
を拡張したもの。</p>
<h2 id="installation">Installation</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">install.packages</span><span class="p">(</span><span class="s">&#34;BiocManager&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">BiocManager</span><span class="o">::</span><span class="nf">install</span><span class="p">(</span><span class="s">&#34;GenomicRanges&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">library</span><span class="p">(</span><span class="n">GenomicRanges</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="iranges"><code>IRanges</code></h2>
<p>両端の値を含む閉区間 <code>[start, end]</code> なのが厄介。
end = start + width - 1 の関係。
width = 0 のときだけ例外的に end &lt; start になり、両端を含まない。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">ir1</span> <span class="o">=</span> <span class="nf">IRanges</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="m">3</span><span class="o">:</span><span class="m">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ir2</span> <span class="o">=</span> <span class="nf">IRanges</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="m">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ir3</span> <span class="o">=</span> <span class="nf">IRanges</span><span class="p">(</span><span class="n">end</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="m">3</span><span class="o">:</span><span class="m">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">stopifnot</span><span class="p">(</span><span class="nf">identical</span><span class="p">(</span><span class="n">ir1</span><span class="p">,</span> <span class="n">ir2</span><span class="p">),</span> <span class="nf">identical</span><span class="p">(</span><span class="n">ir1</span><span class="p">,</span> <span class="n">ir3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">ir1</span>
</span></span></code></pre></div><pre tabindex="0"><code>IRanges object with 4 ranges and 0 metadata columns:
      start end width
  [1]     1   3     3
  [2]     2   3     2
  [3]     3   3     1
  [4]     4   3     0
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">start</span><span class="p">(</span><span class="n">ir1</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 1 2 3 4
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">end</span><span class="p">(</span><span class="n">ir1</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 3 3 3 3
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">width</span><span class="p">(</span><span class="n">ir1</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 3 2 1 0
</code></pre><h2 id="genomicranges"><code>GenomicRanges</code></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">gr</span> <span class="o">=</span> <span class="nf">GRanges</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="n">seqnames</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;chr2&#34;</span><span class="p">,</span> <span class="s">&#34;chr1&#34;</span><span class="p">,</span> <span class="s">&#34;chr1&#34;</span><span class="p">),</span>    <span class="c1"># 染色体の名前</span>
</span></span><span class="line"><span class="cl">  <span class="n">ranges</span> <span class="o">=</span> <span class="nf">IRanges</span><span class="p">(</span><span class="m">101</span><span class="o">:</span><span class="m">103</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="m">100</span><span class="p">),</span>  <span class="c1"># 座標</span>
</span></span><span class="line"><span class="cl">  <span class="n">strand</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#34;-&#34;</span><span class="p">,</span> <span class="s">&#34;+&#34;</span><span class="p">,</span> <span class="s">&#34;*&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="n">score</span> <span class="o">=</span> <span class="m">51</span><span class="o">:</span><span class="m">53</span><span class="p">,</span>                           <span class="c1"># 任意のelementMetadata列</span>
</span></span><span class="line"><span class="cl">  <span class="n">GC</span> <span class="o">=</span> <span class="m">0.1</span> <span class="o">*</span> <span class="m">5</span><span class="o">:</span><span class="m">7</span><span class="p">,</span>                          <span class="c1"># 任意のelementMetadata列</span>
</span></span><span class="line"><span class="cl">  <span class="n">seqinfo</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">seqlengths</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="n">chr1</span> <span class="o">=</span> <span class="m">249250621</span><span class="p">,</span> <span class="n">chr2</span> <span class="o">=</span> <span class="m">243199373</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">gr</span>
</span></span></code></pre></div><pre tabindex="0"><code>GRanges object with 3 ranges and 2 metadata columns:
      seqnames    ranges strand |     score        GC
         &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt; | &lt;integer&gt; &lt;numeric&gt;
  [1]     chr2   101-200      - |        51       0.5
  [2]     chr1   102-201      + |        52       0.6
  [3]     chr1   103-202      * |        53       0.7
  -------
  seqinfo: 2 sequences from an unspecified genome
</code></pre><p>上記のように自分で作る機会はほぼ無くて、
<code>GenomicRanges::makeGRangesFromDataFrame(df)</code>,
<code>rtracklayer::import(&quot;annotation.gff3&quot;)</code>,
<code>GenomicFeatures::genes(txdb)</code>,
のような形で読み込むことが多い。</p>
<p>個々の区間の情報へのアクセスはIRangeと同じ
<code>start(gr)</code>, <code>end(gr)</code>, <code>width(gr)</code>
に加えて:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">seqnames</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>factor-Rle of length 3 with 2 runs
  Lengths:    1    2
  Values : chr2 chr1
Levels(2): chr1 chr2
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">ranges</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>IRanges object with 3 ranges and 0 metadata columns:
      start end width
  [1]   101 200   100
  [2]   102 201   100
  [3]   103 202   100
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">strand</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>factor-Rle of length 3 with 3 runs
  Lengths: 1 1 1
  Values : - + *
Levels(3): + - *
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">mcols</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>DataFrame with 3 rows and 2 columns
      score        GC
  &lt;integer&gt; &lt;numeric&gt;
1        51       0.5
2        52       0.6
3        53       0.7
</code></pre><p><code>S4Vectors::mcols()</code> で参照・代入するのは区間ごとのメタデータ。</p>
<p>データセット全体のメタデータとして染色体の長さなども扱う:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">seqinfo</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>Seqinfo object with 2 sequences from an unspecified genome:
  seqnames seqlengths isCircular genome
  chr1      249250621         NA   &lt;NA&gt;
  chr2      243199373         NA   &lt;NA&gt;
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">seqlevels</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] &#34;chr1&#34; &#34;chr2&#34;
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">seqlengths</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>     chr1      chr2 
249250621 243199373 
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">isCircular</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>chr1 chr2 
  NA   NA 
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">genome</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>chr1 chr2 
  NA   NA 
</code></pre><h2 id="functions">Functions</h2>
<p>多くの関数は <code>IRanges</code> と <code>GenomicRanges</code> で同様に動作する。
より単純な前者で例を示し、後者固有の話は適宜挟む。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">ir</span> <span class="o">=</span> <span class="nf">IRanges</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">14</span><span class="p">,</span> <span class="m">15</span><span class="p">,</span> <span class="m">19</span><span class="p">,</span> <span class="m">34</span><span class="p">,</span> <span class="m">40</span><span class="p">),</span> <span class="n">width</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">12</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">15</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">7</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">ir</span>
</span></span></code></pre></div><pre tabindex="0"><code>IRanges object with 7 ranges and 0 metadata columns:
      start end width
  [1]     1  12    12
  [2]     8  13     6
  [3]    14  19     6
  [4]    15  29    15
  [5]    19  24     6
  [6]    34  35     2
  [7]    40  46     7
</code></pre><p><img src="data:image/png;base64,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" alt="plot of chunk iranges-orig"></p>
<h3 id="intra-range-methods">Intra-range methods</h3>
<p>個々の区間を操作</p>
<dl>
<dt><code>shift(x, shift = 0L, use.names = TRUE)</code></dt>
<dd>ずらす。</dd>
<dt><code>narrow(x, start = NA, end = NA, width = NA, use.names = TRUE)</code></dt>
<dd>狭める。startには正、endには負の値を与える。</dd>
<dd>start = 1, end = -1 のとき何もしないというのがわかりにくすぎて怖い。
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">identical</span><span class="p">(</span><span class="n">ir</span><span class="p">,</span> <span class="nf">narrow</span><span class="p">(</span><span class="n">ir</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">-1</span><span class="p">))</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] TRUE
</code></pre></dd>
<dd><code>threebands(x, start = NA, end = NA, width = NA)</code>
は削られる両端部分も含めて
<code>$left</code>, <code>$middle</code>, <code>$right</code> のリストで返してくれる亜種。</dd>
<dd>逆に広げるには <code>flank()</code> を <code>punion()</code> するか、
<code>+</code> 演算子で両側に広げてから片側を <code>narrow()</code> するか？</dd>
<dt><code>resize(x, width, fix = &quot;start&quot;, use.names = TRUE, ...)</code></dt>
<dd>幅を変える。</dd>
<dd><code>fix</code>: start, end, center</dd>
<dt><code>flank(x, width, start = TRUE, both = FALSE, use.names = TRUE, ...)</code></dt>
<dd>start上流もしくはend下流の領域。両方いっぺんには取れない。</dd>
<dd><code>both = TRUE</code> は start (or end) を起点に両側という意味であり、範囲の両側ではない。
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">flank</span><span class="p">(</span><span class="n">ir</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="n">both</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>IRanges object with 7 ranges and 0 metadata columns:
      start end width
  [1]     0   1     2
  [2]     7   8     2
  [3]    13  14     2
  [4]    14  15     2
  [5]    18  19     2
  [6]    33  34     2
  [7]    39  40     2
</code></pre></dd>
<dd><code>promoters(x, upstream=2000, downstream=200, use.names=TRUE, ...)</code>
はstart起点に上下異なる幅で取ってこられる亜種。</dd>
<dt><code>reflect(x, bounds, use.names = TRUE)</code></dt>
<dd><code>bounds</code> の裏から見た相対位置にする。
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">reflect</span><span class="p">(</span><span class="n">ir</span><span class="p">,</span> <span class="nf">IRanges</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1000</span><span class="p">))</span>
</span></span></code></pre></div><pre tabindex="0"><code>IRanges object with 7 ranges and 0 metadata columns:
      start  end width
  [1]   989 1000    12
  [2]   988  993     6
  [3]   982  987     6
  [4]   972  986    15
  [5]   977  982     6
  [6]   966  967     2
  [7]   955  961     7
</code></pre></dd>
<dd>いかにも負のstrandの座標処理に使えそうだがなぜかGenomicRangesには未対応。
自分で書くならこんな感じか:
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="n">gr</span>
</span></span><span class="line"><span class="cl"><span class="n">bounds</span> <span class="o">=</span> <span class="nf">IRanges</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="nf">seqlengths</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span><span class="nf">[as.vector</span><span class="p">(</span><span class="nf">seqnames</span><span class="p">(</span><span class="n">gr</span><span class="p">))</span><span class="n">]</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">ranges</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="nf">[strand</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#34;-&#34;</span><span class="n">]</span> <span class="o">=</span> <span class="nf">reflect</span><span class="p">(</span><span class="nf">ranges</span><span class="p">(</span><span class="n">gr</span><span class="p">),</span> <span class="n">bounds</span><span class="p">)</span><span class="nf">[strand</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#34;-&#34;</span><span class="n">]</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span>
</span></span></code></pre></div><pre tabindex="0"><code>GRanges object with 3 ranges and 2 metadata columns:
      seqnames              ranges strand |     score        GC
         &lt;Rle&gt;           &lt;IRanges&gt;  &lt;Rle&gt; | &lt;integer&gt; &lt;numeric&gt;
  [1]     chr2 243199174-243199273      - |        51       0.5
  [2]     chr1             102-201      + |        52       0.6
  [3]     chr1             103-202      * |        53       0.7
  -------
  seqinfo: 2 sequences from an unspecified genome
</code></pre></dd>
<dd><code>reverse(x)</code> は <code>reflect(x, range(x))</code> のショートカット。
区間を逆順に並べる <code>rev()</code> とは違う。</dd>
<dt><code>restrict(x, start = NA, end = NA, keep.all.ranges = FALSE, use.names = TRUE)</code></dt>
<dd><code>start</code> から <code>end</code> までの範囲のみ残して外を捨てる。境界含む。</dd>
<dd><code>end = 14</code> で15から始まる区間が取れてきちゃうのはバグじゃない？
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">restrict</span><span class="p">(</span><span class="n">ir</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">14</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>IRanges object with 4 ranges and 0 metadata columns:
      start end width
  [1]    10  12     3
  [2]    10  13     4
  [3]    14  14     1
  [4]    15  14     0
</code></pre></dd>
</dl>
<p>足し算・引き算は両側に伸縮:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">IRanges</span><span class="p">(</span><span class="m">101</span><span class="o">:</span><span class="m">200</span><span class="p">)</span> <span class="o">+</span> <span class="m">100</span>
</span></span></code></pre></div><pre tabindex="0"><code>IRanges object with 1 range and 0 metadata columns:
      start end width
  [1]     1 300   300
</code></pre><p>掛け算はズームイン・ズームアウト:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">IRanges</span><span class="p">(</span><span class="m">101</span><span class="o">:</span><span class="m">200</span><span class="p">)</span> <span class="o">*</span> <span class="m">2</span>
</span></span></code></pre></div><pre tabindex="0"><code>IRanges object with 1 range and 0 metadata columns:
      start end width
  [1]   126 175    50
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">IRanges</span><span class="p">(</span><span class="m">101</span><span class="o">:</span><span class="m">200</span><span class="p">)</span> <span class="o">*</span> <span class="m">0.5</span>
</span></span></code></pre></div><pre tabindex="0"><code>IRanges object with 1 range and 0 metadata columns:
      start end width
  [1]    51 250   200
</code></pre><h3 id="inter-range-methods">Inter-range methods</h3>
<p>区間の集合を操作</p>
<dl>
<dt><code>range(x, ..., with.revmap = FALSE, na.rm = FALSE)</code></dt>
<dd>端から端まで1つの区間として返す。
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">range</span><span class="p">(</span><span class="n">ir</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>IRanges object with 1 range and 0 metadata columns:
      start end width
  [1]     1  46    46
</code></pre></dd>
<dt><code>reduce(x, drop.empty.ranges = FALSE, min.gapwidth = 1L, with.revmap = FALSE)</code></dt>
<dd>重なっている区間をつなげて平らにする。</dd>
<dd><code>with.revmap = TRUE</code> とすると入力した区間がどこに含まれるかをmcolsに保持する。
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">reduce</span><span class="p">(</span><span class="n">ir</span><span class="p">,</span> <span class="n">with.revmap</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>IRanges object with 3 ranges and 1 metadata column:
      start end width |    revmap
  [1]     1  29    29 | 1,2,3,...
  [2]    34  35     2 |         6
  [3]    40  46     7 |         7
</code></pre><p><img src="data:image/png;base64,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" alt="plot of chunk iranges-reduce"></p>
</dd>
<dd><code>min.gapwidth</code> を大きくすると離れた区間もつなげられる。
例えば <code>reduce(ir, min.gapwidth = 10L)</code> で全部つながって <code>range(ir)</code> と同じになる。</dd>
<dt><code>gaps(x, start=NA, end=NA, ...)</code></dt>
<dd><code>IRanges::setdiff(IRanges(start, end), x)</code> と同等。
start/end 省略時は <code>range(x)</code> からの差分。
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">gaps</span><span class="p">(</span><span class="n">ir</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>IRanges object with 2 ranges and 0 metadata columns:
      start end width
  [1]    30  33     4
  [2]    36  39     4
</code></pre></dd>
<dd>GRangesに対しては染色体全体からの差分がstrandごとに計算される:
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">gaps</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>GRanges object with 9 ranges and 0 metadata columns:
      seqnames        ranges strand
         &lt;Rle&gt;     &lt;IRanges&gt;  &lt;Rle&gt;
  [1]     chr1         1-101      +
  [2]     chr1 202-249250621      +
  [3]     chr1   1-249250621      -
  [4]     chr1         1-102      *
  [5]     chr1 203-249250621      *
  [6]     chr2   1-243199373      +
  [7]     chr2         1-100      -
  [8]     chr2 201-243199373      -
  [9]     chr2   1-243199373      *
  -------
  seqinfo: 2 sequences from an unspecified genome
</code></pre></dd>
<dt><code>disjoin(x, ...)</code></dt>
<dd>全ての始点・終点を使い、重なり無しで最多の小区間にして返す。
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">disjoin</span><span class="p">(</span><span class="n">ir</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>IRanges object with 10 ranges and 0 metadata columns:
       start end width
   [1]     1   7     7
   [2]     8  12     5
   [3]    13  13     1
   [4]    14  14     1
   [5]    15  18     4
   [6]    19  19     1
   [7]    20  24     5
   [8]    25  29     5
   [9]    34  35     2
  [10]    40  46     7
</code></pre><p><img src="data:image/png;base64,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" alt="plot of chunk iranges-disjoin"></p>
</dd>
<dt><code>disjointBins(x, ...)</code></dt>
<dd>重ならないように描画するときのy座標に使える。
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">disjointBins</span><span class="p">(</span><span class="n">ir</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 1 2 1 2 3 1 1
</code></pre></dd>
<dt><code>union(x, y)</code>, <code>intersect(x, y)</code>, <code>setdiff(x, y)</code></dt>
<dd>結果は <code>reduce()</code> 済みの区間。</dd>
<dd>element-wise の <code>punion()</code>, <code>pintersect()</code>, <code>psetdiff()</code>, <code>pgap()</code> もある。</dd>
<dt><code>GenomicRanges::subtract(x, y, minoverlap = 1L, ...)</code></dt>
<dd><code>setdiff()</code> と似ているが元の区間ごとの <code>GRangesList</code> にして返す。</dd>
</dl>
<h3 id="overlaps">Overlaps</h3>
<dl>
<dt><code>type</code></dt>
<dd>any: ちょっとでも重なっているか距離が <code>maxgap</code> 以下ならOK。</dd>
<dd>start/end/equal: 開始/終了/両方の距離が <code>maxgap</code> 以下ならOK。</dd>
<dd>within: queryがすっぽり含まれていればOK。 <code>maxgap</code> の意図・挙動は不明。</dd>
<dt><code>findOverlaps(query, subject, maxgap = -1L, minoverlap = 0L, type, select, ...)</code></dt>
<dd><code>select</code>: subject側に複数マッチした場合に何を返すか。
デフォルトの &ldquo;all&rdquo; ならHits型オブジェクト、
&ldquo;first&rdquo; や &ldquo;last&rdquo; なら整数vectorでインデックスを返す。
&ldquo;arbitrary&rdquo; の挙動は謎だが乱数を振ったりするわけではなさそう。
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">findOverlaps</span><span class="p">(</span><span class="n">ir</span><span class="p">,</span> <span class="n">ir</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>Hits object with 15 hits and 0 metadata columns:
       queryHits subjectHits
       &lt;integer&gt;   &lt;integer&gt;
   [1]         1           1
   [2]         1           2
   [3]         2           1
   [4]         2           2
   [5]         3           3
   ...       ...         ...
  [11]         5           3
  [12]         5           4
  [13]         5           5
  [14]         6           6
  [15]         7           7
  -------
  queryLength: 7 / subjectLength: 7
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">findOverlaps</span><span class="p">(</span><span class="n">ir</span><span class="p">,</span> <span class="n">ir</span><span class="p">,</span> <span class="n">select</span> <span class="o">=</span> <span class="s">&#34;first&#34;</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 1 1 3 3 3 6 7
</code></pre></dd>
<dd><code>mergeByOverlaps(query, subject, ...)</code> と
<code>findOverlapPairs(query, subject, ...)</code>
はHits型とは違う謎の形式で返す亜種。</dd>
<dt><code>countOverlaps(query, subject, maxgap = -1L, minoverlap = 0L, type, ...)</code></dt>
<dd>いくつsubjectと重なるか、queryと同じ長さの整数vectorを返す。
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">countOverlaps</span><span class="p">(</span><span class="n">ir</span><span class="p">,</span> <span class="n">ir</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 2 2 3 3 3 1 1
</code></pre></dd>
<dt><code>overlapsAny(query, subject, maxgap = -1L, minoverlap = 0L, type, ...)</code></dt>
<dd>ひとつでもsubjectと重なるものがあるか、queryと同じ長さの論理vectorを返す。
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">overlapsAny</span><span class="p">(</span><span class="n">ir</span><span class="p">,</span> <span class="n">ir[4]</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] FALSE FALSE  TRUE  TRUE  TRUE FALSE FALSE
</code></pre></dd>
<dd><code>%over%</code>, <code>%within%</code> <code>%outside%</code>
という演算子で短く書けるけど可読性低下とconflictが怖いので使わない。</dd>
<dt><code>subsetByOverlaps(x, ranges, maxgap = -1L, minoverlap = 0L, type, invert = FALSE, ...)</code></dt>
<dd><code>x[overlapsAny(x, ranges)]</code> のショートカット。</dd>
<dt><code>overlapsRanges(query, subject, hits = NULL, ...)</code></dt>
<dd>subsetByOverlapsした上、重なっている部分のみ切り詰めて返す。</dd>
<dt><code>poverlaps(query, subject, maxgap = 0L, minoverlap = 1L, type, ...)</code></dt>
<dd><code>min()</code> に対する <code>pmin()</code> のように、element-wiseに比較する。
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">poverlaps</span><span class="p">(</span><span class="n">ir</span><span class="p">,</span> <span class="nf">rev</span><span class="p">(</span><span class="n">ir</span><span class="p">))</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] FALSE FALSE  TRUE  TRUE  TRUE FALSE FALSE
</code></pre></dd>
<dt><code>coverage(x, shift=0L, width=NULL, weight=1L, method=c(&quot;auto&quot;, &quot;sort&quot;, &quot;hash&quot;, &quot;naive&quot;))</code></dt>
<dd>重なりの数をRle型で。
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">coverage</span><span class="p">(</span><span class="n">ir</span><span class="p">,</span> <span class="n">shift</span> <span class="o">=</span> <span class="m">200</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="m">800</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>integer-Rle of length 800 with 13 runs
  Lengths: 200   7   5   2   4   1   5   5   4   2   4   7 554
  Values :   0   1   2   1   2   3   2   1   0   1   0   1   0
</code></pre></dd>
<dd><code>cvg(x, from = NA, to = NA, weight = 1L, varname = &quot;cvg&quot;, collapse = FALSE, ...)</code>
も似たような関数だがドキュメント無し。</dd>
<dd><code>slice(x, ...)</code> を使うと「カバレッジがこれ以上の区間」みたいなのを簡単に取れる:
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">coverage</span><span class="p">(</span><span class="n">ir</span><span class="p">)</span> <span class="o">|&gt;</span> <span class="n">IRanges</span><span class="o">::</span><span class="nf">slice</span><span class="p">(</span><span class="n">lower</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">rangesOnly</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>IRanges object with 2 ranges and 0 metadata columns:
      start end width
  [1]     8  12     5
  [2]    15  24    10
</code></pre></dd>
</dl>
<h3 id="neighboring">Neighboring</h3>
<dl>
<dt><code>nearest(x, subject, select = c(&quot;arbitrary&quot;, &quot;all&quot;))</code></dt>
<dd>最も近いもの、あるいはoverlapしているもの。
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">nearest</span><span class="p">(</span><span class="n">ir</span><span class="p">,</span> <span class="n">ir</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 1 1 2 3 3 6 7
</code></pre></dd>
<dt><code>precede(x, subject, select = c(&quot;first&quot;, &quot;all&quot;))</code></dt>
<dd>subjectのうちどれの上流にあるか。重なるものは除外。
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">precede</span><span class="p">(</span><span class="n">ir</span><span class="p">,</span> <span class="n">ir</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1]  3  3  6  6  6  7 NA
</code></pre></dd>
<dt><code>follow(x, subject, select = c(&quot;last&quot;, &quot;all&quot;))</code></dt>
<dd>subjectのうちどれの下流にあるか。重なるものは除外。
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">follow</span><span class="p">(</span><span class="n">ir</span><span class="p">,</span> <span class="n">ir</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] NA NA  2  2  2  4  6
</code></pre></dd>
<dt><code>distanceToNearest(x, subject, select = c(&quot;arbitrary&quot;, &quot;all&quot;))</code></dt>
<dd>最も近いsubjectへの距離。overlapしている場合はゼロ。
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">distanceToNearest</span><span class="p">(</span><span class="n">ir</span><span class="p">,</span> <span class="n">ir[1</span><span class="o">:</span><span class="m">3</span><span class="n">]</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>Hits object with 7 hits and 1 metadata column:
      queryHits subjectHits |  distance
      &lt;integer&gt;   &lt;integer&gt; | &lt;integer&gt;
  [1]         1           1 |         0
  [2]         2           1 |         0
  [3]         3           2 |         0
  [4]         4           3 |         0
  [5]         5           3 |         0
  [6]         6           3 |        14
  [7]         7           3 |        20
  -------
  queryLength: 7 / subjectLength: 3
</code></pre></dd>
<dd><code>distance(x, y)</code> はelement-wiseに計算。
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">distance</span><span class="p">(</span><span class="n">ir</span><span class="p">,</span> <span class="nf">rev</span><span class="p">(</span><span class="n">ir</span><span class="p">))</span>
</span></span></code></pre></div><pre tabindex="0"><code>[1] 27 20  0  0  0 20 27
</code></pre></dd>
</dl>
<h3 id="ignorestrand"><code>ignore.strand</code></h3>
<p>GenomicRangesの操作はデフォルトでseqnamesとstrandごとに分けて行われる。
strandを無視するには <code>ignore.strand = TRUE</code> を渡す。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">reduce</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>GRanges object with 3 ranges and 0 metadata columns:
      seqnames    ranges strand
         &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt;
  [1]     chr1   102-201      +
  [2]     chr1   103-202      *
  [3]     chr2   101-200      -
  -------
  seqinfo: 2 sequences from an unspecified genome
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="line"><span class="cl"><span class="nf">reduce</span><span class="p">(</span><span class="n">gr</span><span class="p">,</span> <span class="n">ignore.strand</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>GRanges object with 2 ranges and 0 metadata columns:
      seqnames    ranges strand
         &lt;Rle&gt; &lt;IRanges&gt;  &lt;Rle&gt;
  [1]     chr1   102-202      *
  [2]     chr2   101-200      *
  -------
  seqinfo: 2 sequences from an unspecified genome
</code></pre>
</article>
</main>

<nav class="side-bar">
<div class="menu">

<div><a href="/about.html">About</a></div>

<div><a href="/research.html">Research Interests</a></div>

<input type="checkbox" id="menu-rstats" checked>
<label for="menu-rstats" class="active">R stats</label>
<ul>
<li><a href="/rstats/intro.html">R自学自習の基礎知識</a></li>
<li><a href="/rstats/programming.html">RプログラミングTips</a></li>
<li><a href="/rstats/config.html">R環境設定</a></li>
<li><a href="/rstats/ggplot2.html">ggplot2</a></li>
<li><a href="/rstats/dplyr.html">dplyr</a></li>
<li><a href="/rstats/tidyr.html">tidyr</a></li>
<li><a href="/rstats/purrr.html">purrr</a></li>
<li><a href="/rstats/readr.html">readr</a></li>
<li><a href="/rstats/stringr.html">stringr</a></li>
<li><a href="/rstats/knitr.html">knitr</a></li>
<li><a href="/rstats/parallel.html">parallel</a></li>
<li><a href="/rstats/devtools.html">devtools</a></li>
<li><a href="/rstats/rcpp.html">Rcpp</a></li>
<li><a href="/rstats/bioconductor.html">Bioconductor</a></li>
<li class="active"><a href="/rstats/genomicranges.html">GenomicRanges</a></li>
<li><a href="/rstats/rtracklayer.html">rtracklayer</a></li>
<li><a href="/rstats/biomart.html">biomaRt</a></li>
<li><a href="/rstats/edger.html">edgeR</a></li>
<li><a href="/rstats/topgo.html">topGO</a></li>
<li><a href="/rstats/rgl.html">rgl</a></li>
<li><a href="/rstats/stan.html">Stan</a></li>
</ul>

<input type="checkbox" id="menu-python">
<label for="menu-python">Python</label>
<ul>
<li><a href="/python/install.html">Pythonインストール</a></li>
<li><a href="/python/pip.html">pip</a></li>
<li><a href="/python/ipython.html">IPython</a></li>
<li><a href="/python/biopython.html">BioPython</a></li>
<li><a href="/python/concurrent.html">concurrent.futures</a></li>
<li><a href="/python/copy.html">copy</a></li>
<li><a href="/python/matplotlib.html">matplotlib &#43; seaborn</a></li>
<li><a href="/python/scipy.html">NumPy, SciPy</a></li>
<li><a href="/python/pandas.html">Pandas</a></li>
<li><a href="/python/packaging.html">Pythonパッケージ作成</a></li>
</ul>

<input type="checkbox" id="menu-cxx">
<label for="menu-cxx">C&#43;&#43;</label>
<ul>
<li><a href="/cxx/boost.html">Boost</a></li>
<li><a href="/cxx/getopt.html">C&#43;&#43;コマンドライン引数</a></li>
<li><a href="/cxx/speed.html">C&#43;&#43;高速化</a></li>
<li><a href="/cxx/gcc.html">gcc</a></li>
<li><a href="/cxx/bitwise.html">ビット演算</a></li>
<li><a href="/cxx/random.html">擬似乱数生成器</a></li>
</ul>

<input type="checkbox" id="menu-bio">
<label for="menu-bio">Biology</label>
<ul>
<li><a href="/bio/blast.html">BLAST</a></li>
<li><a href="/bio/dadi.html">dadi</a></li>
<li><a href="/bio/gene_ontology.html">Gene Ontology</a></li>
<li><a href="/bio/meme.html">MEME</a></li>
<li><a href="/bio/popgen.html">Population Genetics</a></li>
<li><a href="/bio/repeatmasker.html">RepeatMasker</a></li>
<li><a href="/bio/samtools.html">SAMtools</a></li>
<li><a href="/bio/shirokane.html">SHIROKANE</a></li>
<li><a href="/bio/stochastic_process.html">Stochastic Process</a></li>
<li><a href="/bio/mathmorph.html">数理形態学</a></li>
<li><a href="/bio/linear_algebra.html">線形代数</a></li>
<li><a href="/bio/complexnetwork.html">複雑ネットワーク</a></li>
<li><a href="/bio/nig.html">遺伝研スパコン</a></li>
<li><a href="/bio/motif.html">配列モチーフ探索</a></li>
</ul>

<input type="checkbox" id="menu-dev">
<label for="menu-dev">Developer Tools</label>
<ul>
<li><a href="/dev/apptainer.html">Apptainer</a></li>
<li><a href="/dev/autotools.html">autoconf, automake</a></li>
<li><a href="/dev/cmake.html">CMake</a></li>
<li><a href="/dev/docker.html">Docker</a></li>
<li><a href="/dev/emacs.html">Emacs</a></li>
<li><a href="/dev/git.html">Git</a></li>
<li><a href="/dev/make.html">make</a></li>
<li><a href="/dev/mount.html">mount</a></li>
<li><a href="/dev/rsync.html">rsync</a></li>
<li><a href="/dev/ssh.html">ssh</a></li>
<li><a href="/dev/tmux.html">tmux</a></li>
<li><a href="/dev/torque.html">TORQUE</a></li>
<li><a href="/dev/vi.html">vi</a></li>
<li><a href="/dev/vscode.html">VSCode</a></li>
<li><a href="/dev/zsh.html">zsh</a></li>
<li><a href="/dev/sh.html">シェルスクリプト</a></li>
<li><a href="/dev/nohup.html">プロセス管理</a></li>
<li><a href="/dev/devenv.html">開発環境</a></li>
</ul>

<input type="checkbox" id="menu-mac">
<label for="menu-mac">Mac</label>
<ul>
<li><a href="/mac/applescript.html">AppleScript</a></li>
<li><a href="/mac/homebrew.html">Homebrew</a></li>
<li><a href="/mac/keyboard.html">Keyboard</a></li>
<li><a href="/mac/command.html">Mac固有コマンド</a></li>
<li><a href="/mac/quicklook.html">QuickLook</a></li>
<li><a href="/mac/winebottler.html">WineBottler</a></li>
</ul>

<input type="checkbox" id="menu-lectures">
<label for="menu-lectures">Lectures</label>
<ul>
<li><a href="/lectures/verhoef_comm_ecol-11.html">Community Ecology 輪読会 11章</a></li>
<li><a href="/lectures/git2018nrifs.html">Git入門2018</a></li>
<li><a href="/lectures/git2019makino.html">Git入門2019</a></li>
<li><a href="/lectures/prml-11-1.html">PRML輪読会 11章1節</a></li>
<li><a href="/lectures/prml-2-1.html">PRML輪読会 2章前半</a></li>
<li><a href="/lectures/prml-3-4.html">PRML輪読会 3章4節</a></li>
<li><a href="/lectures/wakeley-2-2.html">Wakeley輪読会 2章2節</a></li>
</ul>

<input type="checkbox" id="menu-misc">
<label for="menu-misc">Miscellaneous</label>
<ul>
<li><a href="/misc/fonts.html">Fonts</a></li>
<li><a href="/misc/gollum.html">Gollum</a></li>
<li><a href="/misc/hugo.html">Hugo</a></li>
<li><a href="/misc/latex.html">LaTeX</a></li>
</ul>

<div><a href="/tags.html">Tags</a></div>
</div>
<search><form action="/search.html">
<input type="search" name="q" placeholder="search">
</form></search>
</nav>
<footer><small>(ɔ) 2008 岩嵜航 Watal M. Iwasaki</small></footer>
</body>
</html>
